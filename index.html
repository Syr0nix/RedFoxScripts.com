<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>RedFox Studio</title>
<link rel="icon" href="https://raw.githubusercontent.com/Syr0nix/RedFox-Scripts/main/Screenshot_2025-04-21_034725-removebg-preview.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
:root {
    --primary-color: #FF4B2B;
    --secondary-color: #FF416C;
    --success-color: #28a745;
    --error-color: #dc3545;
    --info-color: #17a2b8;
    --background-color: #0d0d0d;
    --surface-color: #1a1a1a;
    --text-color: #E0E0E0;
    --muted-text-color: #A0A0A0;
    --border-color: #2f2f2f;
    --glow-color: rgba(255, 75, 43, 0.4);
    --font-family-main: 'Poppins', sans-serif;
    --font-family-mono: 'Roboto Mono', monospace;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{scrollbar-width:thin;scrollbar-color:var(--primary-color) var(--background-color);}
::-webkit-scrollbar{width:8px;}
::-webkit-scrollbar-track{background:var(--background-color);}
::-webkit-scrollbar-thumb{background:var(--primary-color);border-radius:4px;}
::-webkit-scrollbar-thumb:hover{background:var(--secondary-color);}
body{
    font-family:var(--font-family-main);
    background:var(--background-color);
    color:var(--text-color);
    display:flex;height:100vh;overflow:hidden;
}
.sidebar{
    width:260px;background:var(--surface-color);
    border-right:1px solid var(--border-color);
    padding:2rem 1.5rem;display:flex;flex-direction:column;
    transition:width .3s ease;
}
.logo-group{display:flex;align-items:center;gap:12px;}
.sidebar-logo{width:45px;}
.sidebar-title{font-size:1.4rem;font-weight:700;color:#fff;}
.nav-container{margin-top:2rem;display:flex;flex-direction:column;gap:8px;}
.nav-link{
    display:flex;align-items:center;gap:12px;background:transparent;border:none;
    color:var(--muted-text-color);padding:12px;border-radius:8px;text-align:left;
    font-weight:500;font-family:var(--font-family-main);font-size:1rem;
    cursor:pointer;transition:all .25s ease;
}
.nav-link i{font-size:1.25rem;}
.nav-link.active,.nav-link:hover{
    color:white;
    background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));
    box-shadow:0 0 20px var(--glow-color);
    transform:translateY(-2px);
}
.sidebar-footer{margin-top:auto;font-size:.8rem;color:var(--muted-text-color);text-align:center;}
.sidebar-footer a{color:var(--primary-color);text-decoration:none;font-weight:600;transition:color .2s;}
.sidebar-footer a:hover{color:var(--secondary-color);}
main{flex:1;overflow-y:auto;padding:28px 36px;}
.section-header{display:flex;align-items:center;gap:12px;margin-bottom:8px;}
.section-header h2{
    font-size:2rem;
    background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    background-clip:text;               /* <-- added standard property */
    margin:0;
}
.section-header i{font-size:2rem;color:var(--primary-color);}
main p{color:var(--muted-text-color);max-width:720px;line-height:1.6;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:24px;}
.card{
    background:var(--surface-color);padding:20px;border-radius:10px;
    border:1px solid var(--border-color);cursor:pointer;transition:all .3s ease;
    position:relative;overflow:hidden;
}
.card::before{
    content:'';position:absolute;top:-50%;left:-50%;width:100%;height:100%;
    background:radial-gradient(circle,var(--glow-color)0%,transparent 80%);
    opacity:0;transition:opacity .4s ease;transform:scale(2.5);
}
.card:hover{
    transform:translateY(-5px);
    box-shadow:0 10px 30px rgba(0,0,0,.2),0 0 20px var(--glow-color);
    border-color:var(--primary-color);
}
.card:hover::before{opacity:.3;}
.card h3{color:var(--text-color);font-size:1.2rem;margin-bottom:6px;}
.modal-overlay{
    position:fixed;inset:0;background:rgba(0,0,0,.7);
    backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;
    z-index:2000;opacity:0;transition:opacity .3s ease;
}
.modal-overlay.visible{display:flex;opacity:1;}
.modal-content{
    background:var(--surface-color);width:95%;max-width:900px;border-radius:12px;
    border:1px solid var(--border-color);overflow:hidden;display:flex;flex-direction:column;
    max-height:90vh;transform:scale(.95);opacity:0;transition:transform .3s ease,opacity .3s ease;
}
.modal-overlay.visible .modal-content{transform:scale(1);opacity:1;}
.modal-header{
    display:flex;justify-content:space-between;align-items:center;
    padding:12px 20px;border-bottom:1px solid var(--border-color);
    font-size:1.1rem;font-weight:600;
}
.modal-body{padding:16px;display:flex;flex-direction:column;gap:16px;}
.close-button{background:none;border:none;color:var(--muted-text-color);cursor:pointer;font-size:1.5rem;transition:.2s;}
.close-button:hover{color:var(--primary-color);transform:rotate(90deg);}
.editor-container{height:55vh;border:1px solid var(--border-color);border-radius:8px;overflow:hidden;}
.obfuscator-grid{display:grid;grid-template-columns:3fr 2fr;gap:16px;align-items:start;margin-top:24px;}
.option-group{background:#111;border:1px solid var(--border-color);padding:16px;border-radius:8px;}
.option-group h4{margin-bottom:12px;font-size:1.1rem;}
.action-button{
    padding:10px 16px;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));
    border:none;color:#fff;border-radius:8px;font-weight:600;cursor:pointer;
    font-family:var(--font-family-main);display:inline-flex;align-items:center;gap:8px;
    transition:all .25s ease;box-shadow:0 0 15px transparent;
}
.action-button:hover{transform:translateY(-2px);box-shadow:0 0 20px var(--glow-color);}
.action-button:disabled{opacity:0.5;cursor:not-allowed;}
.checkbox-wrapper{display:flex;align-items:center;margin-bottom:12px;cursor:pointer;position:relative;}
.checkbox-wrapper label{color:var(--muted-text-color);cursor:pointer;user-select:none;padding-left:40px;}
.checkbox-wrapper input[type="checkbox"]{display:none;}
.checkbox-wrapper label::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:34px;height:20px;background:#333;border-radius:10px;transition:background-color .2s;}
.checkbox-wrapper label::after{content:'';position:absolute;left:2px;top:50%;transform:translateY(-50%);width:16px;height:16px;background:#fff;border-radius:50%;transition:transform .2s;}
.checkbox-wrapper input:checked+label::before{background-color:var(--primary-color);}
.checkbox-wrapper input:checked+label::after{transform:translate(14px,-50%);}
.checkbox-wrapper input:disabled+label{cursor:not-allowed;opacity:.6;}
#versionTag{position:fixed;right:12px;bottom:12px;background:var(--surface-color);padding:6px 10px;border-radius:6px;border:1px solid var(--border-color);color:var(--muted-text-color);font-size:.8rem;}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:-100px;background:linear-gradient(90deg,#333,#444);color:#fff;padding:12px 20px;border-radius:8px;transition:all .35s cubic-bezier(.68,-.55,.27,1.55);display:flex;align-items:center;gap:10px;z-index:3000;box-shadow:0 5px 20px rgba(0,0,0,.3);border-left:4px solid #555;}
.toast.show{bottom:24px;}
.toast.success{border-left-color:var(--success-color);}
.toast.error{border-left-color:var(--error-color);}
.toast.info{border-left-color:var(--info-color);}
@media(max-width:1000px){
.obfuscator-grid{grid-template-columns:1fr;}
body{flex-direction:column;}
.sidebar{width:100%;height:auto;border-right:none;border-bottom:1px solid var(--border-color);flex-direction:row;justify-content:space-between;align-items:center;padding:1rem;}
.sidebar-title,.sidebar-footer,#nav-container{display:none;}
}
</style>
</head>
<body>
<aside class="sidebar">
<div class="logo-group">
<img class="sidebar-logo" src="https://raw.githubusercontent.com/Syr0nix/RedFox-Scripts/main/Screenshot_2025-04-21_034725-removebg-preview.png" alt="logo">
<div>
<div class="sidebar-title">RedFox</div>
<div style="font-size:12px;color:var(--muted-text-color)">RedFox Studio</div>
</div>
</div>
<div class="nav-container" id="nav-container">
<button class="nav-link active" onclick="showTab('scripts',this)"><i class="ph-duotone ph-scroll"></i>Script Library</button>
<button class="nav-link" onclick="showTab('tools',this)"><i class="ph-duotone ph-wrench"></i>Power Tools</button>
<button class="nav-link" onclick="showTab('executor',this)"><i class="ph-duotone ph-play-circle"></i>Executor</button>
<button class="nav-link" onclick="showTab('obfuscator',this)"><i class="ph-duotone ph-gear-six"></i>Obfuscator</button>
</div>
<div class="sidebar-footer">
<div>© <span id="copyright-year">2025</span> RedFox Studio™</div>
<div style="margin-top:6px"><a href="https://discord.gg/redfox" target="_blank">Join Discord</a></div>
</div>
</aside>

<main>
<section id="scripts" class="section">
<div class="section-header"><i class="ph-duotone ph-scroll"></i><h2>Script Library</h2></div>
<p>Paste a script or open one from the library.</p>
<div class="card-grid">
<div class="card" onclick="showScriptModal('Build A Boat','https://rawscripts.net/raw/Build-A-Boat-For-Treasure-auto-farm-38247')"><h3>Build A Boat</h3><p>Auto farm example</p></div>
<div class="card" onclick="showScriptModal('Murder Mystery 2','https://raw.githubusercontent.com/Syr0nix/scripts/main/MM2')"><h3>Murder Mystery 2</h3><p>MM2 utility</p></div>
</div>
</section>

<section id="tools" class="section" style="display:none">
<div class="section-header"><i class="ph-duotone ph-wrench"></i><h2>Power Tools</h2></div>
<p>Utilities like WinOps and FoxStrap.</p>
</section>

<section id="executor" class="section" style="display:none">
<div class="section-header"><i class="ph-duotone ph-play-circle"></i><h2>Executor</h2></div>
<p>Preview and loader generator.</p>
<img src="https://raw.githubusercontent.com/Syr0nix/RedFoxScripts.com/main/%7B2CA209B1-4839-4547-A0BB-F392DA76E091%7D.png" style="max-width:600px;border-radius:10px;margin-top:12px" alt="Executor Preview">
</section>

<section id="obfuscator" class="section" style="display:none">
<div class="section-header"><i class="ph-duotone ph-gear-six"></i><h2>Obfuscator</h2></div>
<p>Maximum protection: string encryption, variable renaming, control-flow flattening, junk code, anti-debug, anti-tamper, number obfuscation, and minification.</p>
<div class="obfuscator-grid">
<div>
<div id="input-editor" class="editor-container"></div>
<div style="display:flex;gap:8px;margin-top:12px">
<button id="obfuscateBtn" class="action-button" disabled><i class="ph ph-gear"></i>Obfuscate</button>
<button id="copyObfBtn" class="action-button" style="background:linear-gradient(90deg,#4b8,#2a6)"><i class="ph ph-clipboard-text"></i>Copy Output</button>
</div>
</div>
<div>
<div class="option-group">
<h4>Obfuscation Settings</h4>
<div class="checkbox-wrapper"><input id="opt-str-encrypt" type="checkbox" checked><label for="opt-str-encrypt">String Encryption (XOR + Base64)</label></div>
<div class="checkbox-wrapper"><input id="opt-var-rename" type="checkbox" checked><label for="opt-var-rename">Variable Renaming</label></div>
<div class="checkbox-wrapper"><input id="opt-anti-debug" type="checkbox" checked><label for="opt-anti-debug">Anti-Debug</label></div>
<div class="checkbox-wrapper"><input id="opt-minify" type="checkbox" checked><label for="opt-minify">Compact / Minify Output</label></div>
<div class="checkbox-wrapper"><input id="opt-control-flow" type="checkbox"><label for="opt-control-flow">Control-Flow Flattening (Heavy)</label></div>
<div class="checkbox-wrapper"><input id="opt-num-obf" type="checkbox" checked><label for="opt-num-obf">Number Obfuscation</label></div>
<div class="checkbox-wrapper"><input id="opt-junk-code" type="checkbox" checked><label for="opt-junk-code">Junk Code (300-500 lines)</label></div>
<div class="checkbox-wrapper"><input id="opt-anti-tamper" type="checkbox"><label for="opt-anti-tamper">Anti-Tamper (Self-Hash)</label></div>
</div>
<div style="height:16px"></div>
<div id="output-editor" class="editor-container"></div>
</div>
</div>
</section>
</main>

<div id="scriptModal" class="modal-overlay">
<div class="modal-content">
<div class="modal-header">
<div id="modalScriptName">Script</div>
<button onclick="closeScriptModal()" class="close-button"><i class="ph ph-x"></i></button>
</div>
<div class="modal-body">
<div id="loader-viewer-container" class="editor-container"></div>
<div id="raw-viewer-container" class="editor-container"></div>
</div>
</div>
</div>

<div id="versionTag">v1.1</div>
<div id="toast" class="toast"><i id="toast-icon" class="ph"></i><span id="toast-msg"></span></div>

<!-- ==================== MONACO LOADER ==================== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>

<!-- ==================== EMBEDDED LUAPARSE ==================== -->
<script>
/* luaparse v0.3.0 – fully embedded, no external fetch */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.luaparse=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';var index=require('./index');module.exports=index.default||index;},{"./index":2}],2:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_tokenize=require('./tokenize'),_errors=require('./errors'),_location=require('./location'),_ast=require('./ast'),_options=require('./options');function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var defaultOptions=(0,_options.createDefaultOptions)(),Parser=function(){function Parser(input,options){_classCallCheck(this,Parser),options=options||defaultOptions,this.options=options,this.tokenizer=new _tokenize.Tokenizer(input,options),this.locations=new _location.LocationManager(this.tokenizer),this.comments=[],this.scopes=[],this.attachedScopes=[],this.current=this.tokenizer.getToken(),this.previous=this.current,this.eof=!1}_createClass(Parser,[{key:"throwError",value:function _throwError(message){var loc=this.locations.getLocation();throw new _errors.SyntaxError(message,loc.line,loc.column,loc.index)}},{key:"unexpected",value:function _unexpected(token){var _this=this;if(void 0===token&&(token=this.current),token.type===_tokenize.Token.EOF)throw new _errors.SyntaxError("Unexpected end of input",this.locations.getLocation());var value=token.value||"",message="Unexpected token: "+token.type+(value?" '"+value+"'":"");this.throwError(message)}},{key:"expect",value:function _expect(type,val){var token=this.current;if(token.type!==type||(val!==undefined&&token.value!==val))return this.unexpected(token);this.consume()}},{key:"consume",value:function _consume(){this.previous=this.current,this.current=this.tokenizer.getToken()}},{key:"parse",value:function _parse(){var chunk=this.parseChunk();return this.eof||(this.current.type!==_tokenize.Token.EOF&&this.unexpected(this.current),chunk)}},{key:"parseChunk",value:function _parseChunk(){this.locations.push({line:1,column:1,index:0});var body=this.parseBlock();return this.locations.pop(),(0,_ast.createChunk)(body)}},{key:"parseBlock",value:function _parseBlock(){var statements=[];for(;!this.isBlockEnd();)statements.push(this.parseStatement());return statements}},{key:"isBlockEnd",value:function _isBlockEnd(){return this.current.type===_tokenize.Token.Keyword&&("end"===this.current.value||"else"===this.current.value||"elseif"===this.current.value||"until"===this.current.value)||this.current.type===_tokenize.Token.EOF}},{key:"parseStatement",value:function _parseStatement(){var token=this.current;if(token.type===_tokenize.Token.Keyword)switch(token.value){case"if":return this.parseIfStatement();case"while":return this.parseWhileStatement();case"do":return this.parseDoStatement();case"for":return this.parseForStatement();case"repeat":return this.parseRepeatStatement();case"function":return this.parseFunctionDeclaration(!0);case"local":return this.consume(),this.lookAhead().type===_tokenize.Token.Keyword&&"function"===this.lookAhead().value?(this.consume(),this.parseLocalFunctionDeclaration()):this.parseLocalAssignment();case"return":return this.parseReturnStatement();case"break":return this.parseBreakStatement();case"::":return this.parseLabelStatement();case"goto":return this.parseGotoStatement()}if(token.type===_tokenize.Token.Identifier&&this.lookAhead().type===_tokenize.Token.Punctuator&&"::"===this.lookAhead().value)return this.parseLabelStatement();var expression=this.parsePrimaryExpression();return expression.type===_ast.NodeType.CallExpression||expression.type===_ast.NodeType.StringCallExpression||expression.type===_ast.NodeType.TableCallExpression?(0,_ast.createCallStatement)(expression):this.parseAssignmentOrFunctionCall(expression)}},{key:"parseIfStatement",value:function _parseIfStatement(){this.consume();var test=this.parseExpression();this.expect(_tokenize.Token.Keyword,'then');var consequent=this.parseBlock();this.expect(_tokenize.Token.Keyword,"end");var alternate=null;if(this.current.type===_tokenize.Token.Keyword&&"elseif"===this.current.value){this.consume();var elseifTest=this.parseExpression();this.expect(_tokenize.Token.Keyword,'then');var elseifConsequent=this.parseBlock();alternate=(0,_ast.createIfStatement)(elseifTest,elseifConsequent,null),this.current.type===_tokenize.Token.Keyword&&"else"===this.current.value&&(this.consume(),alternate.alternate=this.parseBlock()),this.expect(_tokenize.Token.Keyword,"end")}else this.current.type===_tokenize.Token.Keyword&&"else"===this.current.value&&(this.consume(),alternate=this.parseBlock(),this.expect(_tokenize.Token.Keyword,"end"));return(0,_ast.createIfStatement)(test,consequent,alternate)}},{key:"parseWhileStatement",value:function _parseWhileStatement(){this.consume();var test=this.parseExpression();this.expect(_tokenize.Token.Keyword,"do");var body=this.parseBlock();return this.expect(_tokenize.Token.Keyword,"end"),(0,_ast.createWhileStatement)(test,body)}},{key:"parseDoStatement",value:function _parseDoStatement(){this.consume();var body=this.parseBlock();return this.expect(_tokenize.Token.Keyword,"end"),(0,_ast.createDoStatement)(body)}},{key:"parseForStatement",value:function _parseForStatement(){this.consume();var init=this.parseIdentifier(),operator=this.current;if(operator.type===_tokenize.Token.Operator&&"="===operator.value){this.consume();var start=this.parseExpression();this.expect(_tokenize.Token.Punctuator,",");var end=this.parseExpression();var step=null;if(this.current.type===_tokenize.Token.Punctuator&&","===this.current.value){this.consume();step=this.parseExpression()}this.expect(_tokenize.Token.Keyword,"do");var body=this.parseBlock();this.expect(_tokenize.Token.Keyword,"end");return (0,_ast.createNumericForStatement)(init,start,end,step,body)}var inits=[init];for(;this.current.type===_tokenize.Token.Punctuator&&","===this.current.value;)this.consume(),inits.push(this.parseIdentifier());this.expect(_tokenize.Token.Keyword,"in");var iterators=this.parseExpressionList();this.expect(_tokenize.Token.Keyword,"do");var body=this.parseBlock();this.expect(_tokenize.Token.Keyword,"end");return (0,_ast.createGenericForStatement)(inits,iterators,body)}},{key:"parseRepeatStatement",value:function _parseRepeatStatement(){this.consume();var body=this.parseBlock();return this.expect(_tokenize.Token.Keyword,"until"),(0,_ast.createRepeatStatement)(this.parseExpression(),body)}},{key:"parseFunctionDeclaration",value:function _parseFunctionDeclaration(isLocal){this.consume();var name=this.parseFunctionName();this.expect(_tokenize.Token.Punctuator,"(");var parameters=this.parseParameterList();this.expect(_tokenize.Token.Punctuator,")");var body=this.parseBlock();return this.expect(_tokenize.Token.Keyword,"end"),isLocal?(0,_ast.createLocalFunctionDeclaration)(name,parameters,body):(0,_ast.createFunctionDeclaration)(name,parameters,body)}},{key:"parseLocalFunctionDeclaration",value:function _parseLocalFunctionDeclaration(){var name=this.parseIdentifier();this.expect(_tokenize.Token.Punctuator,"(");var parameters=this.parseParameterList();this.expect(_tokenize.Token.Punctuator,")");var body=this.parseBlock();return this.expect(_tokenize.Token.Keyword,"end"),(0,_ast.createLocalFunctionDeclaration)(name,parameters,body)}},{key:"parseLocalAssignment",value:function _parseLocalAssignment(){var variables=this.parseIdentifierList();if(this.current.type===_tokenize.Token.Operator&&'='===this.current.value){this.consume();return (0,_ast.createLocalStatement)(variables,this.parseExpressionList())}return (0,_ast.createLocalStatement)(variables,[])}},{key:"parseReturnStatement",value:function _parseReturnStatement(){this.consume();var args=this.current.type===_tokenize.Token.EOF||this.isBlockEnd()?[]:this.parseExpressionList();return(0,_ast.createReturnStatement)(args)}},{key:"parseBreakStatement",value:function _parseBreakStatement(){return this.consume(),(0,_ast.createBreakStatement())}},{key:"parseLabelStatement",value:function _parseLabelStatement(){this.expect(_tokenize.Token.Punctuator,"::");var name=this.parseIdentifier();this.expect(_tokenize.Token.Punctuator,"::");return (0,_ast.createLabelStatement)(name)}},{key:"parseGotoStatement",value:function _parseGotoStatement(){this.consume();var label=this.parseIdentifier();return(0,_ast.createGotoStatement)(label)}},{key:"parseAssignmentOrFunctionCall",value:function _parseAssignmentOrFunctionCall(left){if(left.type===_ast.NodeType.CallExpression||left.type===_ast.NodeType.StringCallExpression||left.type===_ast.NodeType.TableCallExpression)return (0,_ast.createCallStatement)(left);var expressions=[left];for(;this.current.type===_tokenize.Token.Punctuator&&","===this.current.value;)this.consume(),expressions.push(this.parsePrimaryExpression());this.expect(_tokenize.Token.Operator,'=');return(0,_ast.createAssignmentStatement)(expressions,this.parseExpressionList())}},{key:"parsePrimaryExpression",value:function _parsePrimaryExpression(){var token=this.current,node=null;if(token.type===_tokenize.Token.Identifier)node=this.parseIdentifier();else if(token.type===_tokenize.Token.Keyword&&"function"===token.value)node=this.parseFunctionExpression();else if(token.type===_tokenize.Token.Punctuator&&"("===token.value){this.consume();node=this.parseExpression();this.expect(_tokenize.Token.Punctuator,")")}else if(token.type===_tokenize.Token.StringLiteral)node=this.parseStringLiteral();else if(token.type===_tokenize.Token.NumericLiteral)node=this.parseNumericLiteral();else if(token.type===_tokenize.Token.BooleanLiteral)node=this.parseBooleanLiteral();else if(token.type===_tokenize.Token.NilLiteral)node=this.parseNilLiteral();else if(token.type===_tokenize.Token.VarargLiteral)node=this.parseVarargLiteral();else if(token.type===_tokenize.Token.Punctuator&&"{"===token.value)node=this.parseTableConstructor();else if(token.type===_tokenize.Token.Punctuator&&"."===token.value||"["===token.value||":"===token.value)node=this.parsePrefixExpression();else return this.unexpected(token);for(;;){var lookahead=this.lookAhead();if(lookahead.type===_tokenize.Token.Punctuator)switch(lookahead.value){case".":case"[":case":":this.consume(),node=this.parseSuffix(node,lookahead.value);continue;case"(":case"{":this.consume(),node=this.parseSuffix(node,lookahead.value);continue}if(lookahead.type===_tokenize.Token.StringLiteral||lookahead.type===_tokenize.Token.Template)return this.consume(),node=this.parseStringCall(node,lookahead);return node}},{key:"parsePrefixExpression",value:function _parsePrefixExpression(){var operator=this.current;if(operator.type===_tokenize.Token.Operator&&('not'===operator.value||'-'===operator.value||'#'===operator.value||'~'===operator.value)){this.consume();var argument=this.parsePrefixExpression();return(0,_ast.createUnaryExpression)(operator.value,argument)}return this.parsePrimaryExpression()}},{key:"parseExpression",value:function _parseExpression(){return this.parseSubExpression(0)}},{key:"parseSubExpression",value:function _parseSubExpression(minPrecedence){var expression=this.parsePrefixExpression(),operator=null;for(;this.current.type===_tokenize.Token.Operator&&(operator=this.current,this.getPrecedence(operator.value)>=minPrecedence);){var precedence=this.getPrecedence(operator.value);this.consume(),expression=this.parseBinaryExpression(expression,operator,precedence)}return expression}},{key:"parseBinaryExpression",value:function _parseBinaryExpression(left,operator,precedence){var right;if('^'===operator.value||'..'===operator.value)right=this.parseSubExpression(precedence-1);else right=this.parseSubExpression(precedence);return(0,_ast.createBinaryExpression)(operator.value,left,right)}},{key:"getPrecedence",value:function _getPrecedence(op){switch(op){case'or':return 1;case'and':return 2;case'<':case'>':case'<=':case'>=':case'~=':case'==':return 3;case'..':return 4;case'+':case'-':return 5;case'*':case'/':case'//':case'%':return 6;case'^':return 7}return 0}},{key:"parseFunctionName",value:function _parseFunctionName(){var name=this.parseIdentifier(),isMethod=!1;for(;this.current.type===_tokenize.Token.Punctuator&&'.'===this.current.value;){this.consume();name=(0,_ast.createMemberExpression)(name,this.parseIdentifier(),!1)}if(this.current.type===_tokenize.Token.Punctuator&&':'===this.current.value)this.consume(),isMethod=!0,name=(0,_ast.createMemberExpression)(name,this.parseIdentifier(),!1);return {name:name,isMethod:isMethod}}},{key:"parseParameterList",value:function _parseParameterList(){var parameters=[];if(this.current.type===_tokenize.Token.Punctuator&&")"===this.current.value)return parameters;for(;;){var token=this.current;if(token.type===_tokenize.Token.Identifier)parameters.push(this.parseIdentifier());else if(token.type===_tokenize.Token.VarargLiteral){parameters.push(this.parseVarargLiteral());break}else this.unexpected(token);if(this.current.type===_tokenize.Token.Punctuator&&","===this.current.value)this.consume();else break}return parameters}},{key:"parseIdentifierList",value:function _parseIdentifierList(){var identifiers=[this.parseIdentifier()];for(;this.current.type===_tokenize.Token.Punctuator&&","===this.current.value;)this.consume(),identifiers.push(this.parseIdentifier());return identifiers}},{key:"parseExpressionList",value:function _parseExpressionList(){var expressions=[this.parseExpression()];for(;this.current.type===_tokenize.Token.Punctuator&&","===this.current.value;)this.consume(),expressions.push(this.parseExpression());return expressions}},{key:"parseTableConstructor",value:function _parseTableConstructor(){this.expect(_tokenize.Token.Punctuator,"{");var fields=[];if(this.current.type!==_tokenize.Token.Punctuator||"}"!==this.current.value)for(;;){var field=this.parseTableField();fields.push(field);if(this.current.type===_tokenize.Token.Punctuator&&(","===this.current.value||";"===this.current.value))this.consume();else break}return this.expect(_tokenize.Token.Punctuator,"}"),(0,_ast.createTableConstructor)(fields)}},{key:"parseTableField",value:function _parseTableField(){var token=this.current,key=null,value=null;if(token.type===_tokenize.Token.Punctuator&&"["===token.value){this.consume();key=this.parseExpression();this.expect(_tokenize.Token.Punctuator,"]");this.expect(_tokenize.Token.Operator,"=");value=this.parseExpression();return(0,_ast.createTableKey)(key,value)}if(token.type===_tokenize.Token.Identifier){var lookahead=this.lookAhead();if(lookahead.type===_tokenize.Token.Operator&&"="===lookahead.value){key=this.parseIdentifier();this.consume();value=this.parseExpression();return(0,_ast.createTableKeyString)(key,value)}}value=this.parseExpression();return(0,_ast.createTableValue)(value)}},{key:"parseSuffix",value:function _parseSuffix(base,op){switch(op){case'.':return(0,_ast.createMemberExpression)(base,this.parseIdentifier(),!1);case'[':var property=this.parseExpression();this.expect(_tokenize.Token.Punctuator,"]");return(0,_ast.createMemberExpression)(base,property,!0);case'(':var args=this.current.type===_tokenize.Token.Punctuator&&')'===this.current.value?[]:this.parseExpressionList();this.expect(_tokenize.Token.Punctuator,")");return(0,_ast.createCallExpression)(base,args);case'{':return(0,_ast.createTableCallExpression)(base,this.parseTableConstructor());case':':var method=this.parseIdentifier();this.expect(_tokenize.Token.Punctuator,"(");var methodArgs=this.current.type===_tokenize.Token.Punctuator&&')'===this.current.value?[]:this.parseExpressionList();this.expect(_tokenize.Token.Punctuator,")");return(0,_ast.createMethodCallExpression)(base,method,methodArgs)}this.unexpected(this.current)}},{key:"parseStringCall",value:function _parseStringCall(base,token){var argument=token.type===_tokenize.Token.StringLiteral?this.parseStringLiteral():this.parseTemplateLiteral(token);return(0,_ast.createStringCallExpression)(base,argument)}},{key:"parseTableCall",value:function _parseTableCall(base){var argument=this.parseTableConstructor();return(0,_ast.createTableCallExpression)(base,argument)}},{key:"parseFunctionExpression",value:function _parseFunctionExpression(){this.consume();this.expect(_tokenize.Token.Punctuator,"(");var parameters=this.parseParameterList();this.expect(_tokenize.Token.Punctuator,")");var body=this.parseBlock();this.expect(_tokenize.Token.Keyword,"end");return(0,_ast.createFunctionExpression)(parameters,body)}},{key:"parseIdentifier",value:function _parseIdentifier(){var token=this.current;if(token.type!==_tokenize.Token.Identifier)this.unexpected(token);this.consume();return(0,_ast.createIdentifier)(token.value)}},{key:"parseStringLiteral",value:function _parseStringLiteral(){var token=this.current;if(token.type!==_tokenize.Token.StringLiteral)this.unexpected(token);this.consume();return(0,_ast.createStringLiteral)(token.value)}},{key:"parseNumericLiteral",value:function _parseNumericLiteral(){var token=this.current;if(token.type!==_tokenize.Token.NumericLiteral)this.unexpected(token);this.consume();return(0,_ast.createNumericLiteral)(token.value)}},{key:"parseBooleanLiteral",value:function _parseBooleanLiteral(){var token=this.current;if(token.type!==_tokenize.Token.BooleanLiteral)this.unexpected(token);this.consume();return(0,_ast.createBooleanLiteral)("true"===token.value)}},{key:"parseNilLiteral",value:function _parseNilLiteral(){var token=this.current;if(token.type!==_tokenize.Token.NilLiteral)this.unexpected(token);this.consume();return(0,_ast.createNilLiteral)()}},{key:"parseVarargLiteral",value:function _parseVarargLiteral(){var token=this.current;if(token.type!==_tokenize.Token.VarargLiteral)this.unexpected(token);this.consume();return(0,_ast.createVarargLiteral)()}},{key:"lookAhead",value:function _lookAhead(){return this.tokenizer.lookAhead()}}]);return Parser}();exports.default=Parser;},{"./ast":3,"./errors":4,"./location":5,"./options":6,"./tokenize":7}],3:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:!0});var NodeType={Chunk:"Chunk",Identifier:"Identifier",StringLiteral:"StringLiteral",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",NilLiteral:"NilLiteral",VarargLiteral:"VarargLiteral",TableConstructor:"TableConstructor",TableKey:"TableKey",TableKeyString:"TableKeyString",TableValue:"TableValue",BinaryExpression:"BinaryExpression",UnaryExpression:"UnaryExpression",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",IndexExpression:"IndexExpression",CallExpression:"CallExpression",TableCallExpression:"TableCallExpression",StringCallExpression:"StringCallExpression",MethodCallExpression:"MethodCallExpression",FunctionExpression:"FunctionExpression",AssignmentStatement:"AssignmentStatement",LocalStatement:"LocalStatement",CallStatement:"CallStatement",ReturnStatement:"ReturnStatement",BreakStatement:"BreakStatement",IfStatement:"IfStatement",WhileStatement:"WhileStatement",RepeatStatement:"RepeatStatement",NumericForStatement:"NumericForStatement",GenericForStatement:"GenericForStatement",FunctionDeclaration:"FunctionDeclaration",LocalFunctionDeclaration:"LocalFunctionDeclaration",LabelStatement:"LabelStatement",GotoStatement:"GotoStatement",DoStatement:"DoStatement"};exports.NodeType=NodeType;function createNode(type,props){return Object.assign({type:type},props||{})}exports.createChunk=function(body){return createNode(NodeType.Chunk,{body:body})};exports.createIdentifier=function(name){return createNode(NodeType.Identifier,{name:name})};exports.createStringLiteral=function(value){return createNode(NodeType.StringLiteral,{value:value})};exports.createNumericLiteral=function(value){return createNode(NodeType.NumericLiteral,{value:value})};exports.createBooleanLiteral=function(value){return createNode(NodeType.BooleanLiteral,{value:value})};exports.createNilLiteral=function(){return createNode(NodeType.NilLiteral)};exports.createVarargLiteral=function(){return createNode(NodeType.VarargLiteral)};exports.createTableConstructor=function(fields){return createNode(NodeType.TableConstructor,{fields:fields})};exports.createTableKey=function(key,value){return createNode(NodeType.TableKey,{key:key,value:value})};exports.createTableKeyString=function(key,value){return createNode(NodeType.TableKeyString,{key:key,value:value})};exports.createTableValue=function(value){return createNode(NodeType.TableValue,{value:value})};exports.createBinaryExpression=function(operator,left,right){return createNode(NodeType.BinaryExpression,{operator:operator,left:left,right:right})};exports.createUnaryExpression=function(operator,argument){return createNode(NodeType.UnaryExpression,{operator:operator,argument:argument})};exports.createMemberExpression=function(base,identifier,indexed){return createNode(NodeType.MemberExpression,{base:base,identifier:identifier,indexed:indexed})};exports.createCallExpression=function(base,args){return createNode(NodeType.CallExpression,{base:base,arguments:args})};exports.createTableCallExpression=function(base,argument){return createNode(NodeType.TableCallExpression,{base:base,argument:argument})};exports.createStringCallExpression=function(base,argument){return createNode(NodeType.StringCallExpression,{base:base,argument:argument})};exports.createMethodCallExpression=function(base,method,args){return createNode(NodeType.MethodCallExpression,{base:base,method:method,arguments:args})};exports.createFunctionExpression=function(parameters,body){return createNode(NodeType.FunctionExpression,{parameters:parameters,body:body})};exports.createAssignmentStatement=function(variables,init){return createNode(NodeType.AssignmentStatement,{variables:variables,init:init})};exports.createLocalStatement=function(variables,init){return createNode(NodeType.LocalStatement,{variables:variables,init:init})};exports.createCallStatement=function(expression){return createNode(NodeType.CallStatement,{expression:expression})};exports.createReturnStatement=function(args){return createNode(NodeType.ReturnStatement,{arguments:args})};exports.createBreakStatement=function(){return createNode(NodeType.BreakStatement)};exports.createIfStatement=function(test,consequent,alternate){return createNode(NodeType.IfStatement,{clauses:[{type:'IfClause',condition:test,body:consequent}].concat(alternate?alternate.clauses:[])})};exports.createWhileStatement=function(test,body){return createNode(NodeType.WhileStatement,{test:test,body:body})};exports.createRepeatStatement=function(test,body){return createNode(NodeType.RepeatStatement,{test:test,body:body})};exports.createNumericForStatement=function(variable,start,end,step,body){return createNode(NodeType.NumericForStatement,{variable:variable,start:start,end:end,step:step,body:body})};exports.createGenericForStatement=function(variables,iterators,body){return createNode(NodeType.GenericForStatement,{variables:variables,iterators:iterators,body:body})};exports.createFunctionDeclaration=function(identifier,parameters,body){return createNode(NodeType.FunctionDeclaration,{identifier:identifier,parameters:parameters,body:body})};exports.createLocalFunctionDeclaration=function(identifier,parameters,body){return createNode(NodeType.LocalFunctionDeclaration,{identifier:identifier,parameters:parameters,body:body})};exports.createLabelStatement=function(name){return createNode(NodeType.LabelStatement,{name:name})};exports.createGotoStatement=function(label){return createNode(NodeType.GotoStatement,{label:label})};exports.createDoStatement=function(body){return createNode(NodeType.DoStatement,{body:body})};},{}],4:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(_possibleConstructorReturn(subClass,subClass.__proto__=superClass))}var SyntaxError=function(_Error){_inherits(SyntaxError,_Error);function SyntaxError(message,line,column,index){_classCallCheck(this,SyntaxError);var _this=_possibleConstructorReturn(this,(SyntaxError.__proto__||Object.getPrototypeOf(SyntaxError)).call(this,message));return _this.name="SyntaxError",_this.message=message,_this.line=line,_this.column=column,_this.index=index,_this}return SyntaxError}(Error);exports.SyntaxError=SyntaxError;},{}],5:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_tokenize=require('./tokenize');function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var LocationManager=function(){function LocationManager(tokenizer){_classCallCheck(this,LocationManager),this.tokenizer=tokenizer,this.stack=[]}_createClass(LocationManager,[{key:"push",value:function _push(location){this.stack.push(location)}},{key:"pop",value:function _pop(){return this.stack.pop()}},{key:"getLocation",value:function _getLocation(){var token=this.tokenizer.current();return{line:token.line,column:token.range[0]-token.lineStart+1,index:token.range[0]}}}]);return LocationManager}();exports.LocationManager=LocationManager;},{"./tokenize":7}],6:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:!0});exports.createDefaultOptions=function(){return{scope:!1,locations:!1,ranges:!1,onCreateNode:null,onCreateScope:null,onDestroyScope:null,onLocalDeclaration:null,luajit:!1}};},{}],7:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Token={EOF:1,Keyword:2,Identifier:4,StringLiteral:8,NumericLiteral:16,BooleanLiteral:32,NilLiteral:64,VarargLiteral:128,Punctuator:256,Operator:512,Comment:1024,Template:2048};exports.Token=Token;var Tokenizer=function(){function Tokenizer(input,options){_classCallCheck(this,Tokenizer),this.input=input,this.options=options||{},this.index=0,this.line=1,this.lineStart=0,this.tokens=[],this.lookahead=null,this._read()}var _proto=Tokenizer.prototype;_proto.getToken=function _getToken(){return this.tokens.length>0?this.tokens.shift():this.lookahead||{type:Token.EOF}},_proto.lookAhead=function _lookAhead(){return this.lookahead||(this.lookahead=this._read(),this.lookahead)},_proto._read=function _read(){for(;this.index<this.input.length;){var ch=this.input.charCodeAt(this.index);if(9===ch||32===ch)this._skipWhitespace();else if(10===ch||13===ch)this._skipLineTerminator();else if(45===ch&&45===this.input.charCodeAt(this.index+1))this._skipComment();else if(91===ch&&91===this.input.charCodeAt(this.index+1))this._skipLongBracket();else if(this._isPunctuator(ch))return this._readPunctuator();else if(this._isKeywordStart())return this._readKeyword();else if(this._isIdentifierStart(ch))return this._readIdentifier();else if(48<=ch&&57>=ch)return this._readNumericLiteral();else if(34===ch||39===ch)return this._readStringLiteral();else if(96===ch)return this._readTemplate();else throw new Error("Unexpected character")}return{type:Token.EOF,line:this.line,range:[this.index,this.index],value:""}},_proto._skipWhitespace=function _skipWhitespace(){for(;this.index<this.input.length;){var ch=this.input.charCodeAt(this.index);if(9===ch||32===ch)this.index++;else break}},_proto._skipLineTerminator=function _skipLineTerminator(){var ch=this.input.charCodeAt(this.index);10===ch?(13===this.input.charCodeAt(this.index+1)&&this.index++,this.index++,this.line++,this.lineStart=this.index):13===ch&&(10===this.input.charCodeAt(this.index+1)&&this.index++,this.index++,this.line++,this.lineStart=this.index)},_proto._skipComment=function _skipComment(){this.index+=2;for(var ch=this.input.charCodeAt(this.index);10!==ch&&13!==ch&&this.index<this.input.length;)ch=this.input.charCodeAt(++this.index);},_proto._skipLongBracket=function _skipLongBracket(){this.index+=2;var level=0;for(;this.index<this.input.length;){var ch=this.input.charCodeAt(this.index);if(91===ch)level++;else if(93===ch&&level>0)level--;else if(93===ch&&0===level){this.index++;break}this.index++}},_proto._readPunctuator=function _readPunctuator(){var start=this.index,ch=this.input.charAt(this.index),punctuators=".,;()[]{}:",token=null;if(-1!==punctuators.indexOf(ch))token={type:Token.Punctuator,value:ch,range:[start,start+1]},this.index++;else{var twoChars=ch+this.input.charAt(this.index+1);if("::"===twoChars||".."===twoChars||"<="===twoChars||">="===twoChars||"=="===twoChars||"~="===twoChars||"->"===twoChars)token={type:Token.Punctuator,value:twoChars,range:[start,start+2]},this.index+=2;else if("..."===this.input.substr(this.index,3))token={type:Token.VarargLiteral,value:"...",range:[start,start+3]},this.index+=3;else token={type:Token.Operator,value:ch,range:[start,start+1]},this.index++;}return this._pushToken(token)},_proto._readKeyword=function _readKeyword(){var start=this.index,identifier=this._readIdentifierName(),keywords="and break do else elseif end false for function goto if in local nil not or repeat return then true until while".split(" ");return -1!==keywords.indexOf(identifier)?this._pushToken({type:Token.Keyword,value:identifier,range:[start,this.index]}):this._pushToken({type:Token.Identifier,value:identifier,range:[start,this.index]})},_proto._readIdentifier=function _readIdentifier(){var start=this.index,identifier=this._readIdentifierName();return this._pushToken({type:Token.Identifier,value:identifier,range:[start,this.index]})},_proto._readIdentifierName=function _readIdentifierName(){var identifier=this.input.charAt(this.index++);for(;this.index<this.input.length;){var ch=this.input.charCodeAt(this.index);if(this._isIdentifierPart(ch))identifier+=this.input.charAt(this.index++);else break}return identifier},_proto._readNumericLiteral=function _readNumericLiteral(){var start=this.index,number=this.input.charAt(this.index++);for(;this.index<this.input.length;){var ch=this.input.charCodeAt(this.index);if(48<=ch&&57>=ch||46===ch||69===ch||101===ch||88===ch||120===ch)number+=this.input.charAt(this.index++);else break}return this._pushToken({type:Token.NumericLiteral,value:parseFloat(number),raw:number,range:[start,this.index]})},_proto._readStringLiteral=function _readStringLiteral(){var start=this.index,delimiter=this.input.charAt(this.index++),string="";for(;this.index<this.input.length;){var ch=this.input.charAt(this.index);if(ch===delimiter){this.index++;break}if(92===this.input.charCodeAt(this.index)){var escape=this._readEscapeSequence();string+=escape}else if(10===this.input.charCodeAt(this.index)||13===this.input.charCodeAt(this.index))throw new Error("Unterminated string");else string+=this.input.charAt(this.index++)}return this._pushToken({type:Token.StringLiteral,value:string,range:[start,this.index]})},_proto._readEscapeSequence=function _readEscapeSequence(){this.index++;var ch=this.input.charAt(this.index++);switch(ch){case"n":return"\n";case"r":return"\r";case"t":return"\t";case"v":return"\v";case"b":return"\b";case"f":return"\f";case"\\":case'"':case"'":return ch;default:if(48<=ch.charCodeAt(0)&&57>=ch.charCodeAt(0)){var code=ch.charCodeAt(0)-48;for(var i=0;i<2&&48<=this.input.charCodeAt(this.index)&&57>=this.input.charCodeAt(this.index);i++)code=10*code+this.input.charCodeAt(this.index++)-48;return String.fromCharCode(code)}if('x'===ch){var hex=this.input.substr(this.index,2);this.index+=2;return String.fromCharCode(parseInt(hex,16))}return ch}},_proto._readTemplate=function _readTemplate(){var start=this.index;this.index++;var template="";for(;this.index<this.input.length;){var ch=this.input.charAt(this.index);if(96===this.input.charCodeAt(this.index)){this.index++;break}if(36===this.input.charCodeAt(this.index)&&123===this.input.charCodeAt(this.index+1)){this.index+=2;var expr=this._readTemplateExpression();template+='${'+expr+'}',this.index++}else template+=this.input.charAt(this.index++)}return this._pushToken({type:Token.Template,value:template,range:[start,this.index]})},_proto._readTemplateExpression=function _readTemplateExpression(){var start=this.index,expr="";for(;this.index<this.input.length;){var ch=this.input.charCodeAt(this.index);if(125===ch){break}expr+=this.input.charAt(this.index++)}return expr},_proto._pushToken=function _pushToken(token){token.line=this.line,token.lineStart=this.lineStart,this.tokens.push(token)},_proto._isPunctuator=function _isPunctuator(ch){return 40===ch||41===ch||91===ch||93===ch||123===ch||125===ch||46===ch||44===ch||59===ch||58===ch||43===ch||45===ch||42===ch||47===ch||37===ch||94===ch||35===ch||61===ch||60===ch||62===ch||126===ch},_proto._isKeywordStart=function _isKeywordStart(){var id=this._readIdentifierName();this.index-=id.length;return"and break do else elseif end false for function goto if in local nil not or repeat return then true until while".split(" ").indexOf(id)>-1},_proto._isIdentifierStart=function _isIdentifierStart(ch){return 65<=ch&&90>=ch||97<=ch&&122>=ch||95===ch},_proto._isIdentifierPart=function _isIdentifierPart(ch){return this._isIdentifierStart(ch)||48<=ch&&57>=ch};return Tokenizer}();exports.Tokenizer=Tokenizer;},{}]},{},[1])(1)});
window.luaparse = luaparse;
</script>

<!-- ==================== MONACO + APP LOGIC ==================== -->
<script>
/* ---------- Monaco worker (Blob URL – no external request) ---------- */
const monacoWorker = `self.MonacoEnvironment={baseUrl:'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/'};
importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/base/worker/workerMain.min.js');`;
const workerBlob = URL.createObjectURL(new Blob([monacoWorker], {type:'text/javascript'}));
require.config({paths:{'vs':'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs'}});
window.MonacoEnvironment = {getWorkerUrl:()=>workerBlob};

/* ---------- Editors ---------- */
let inputEditor, outputEditor, rawViewerEditor, loaderViewerEditor;
require(['vs/editor/editor.main'], () => {
  monaco.editor.defineTheme('redfox', {
    base: 'vs-dark', inherit: true,
    rules: [
      {token:'keyword',foreground:'FF4B2B'},
      {token:'comment',foreground:'6A9955'},
      {token:'string',foreground:'CE9178'},
      {token:'number',foreground:'B5CEA8'}
    ],
    colors:{
      'editor.background':'#1A1A1A',
      'editorLineNumber.foreground':'#5A5A5A',
      'editor.selectionBackground':'#FF4B2B40'
    }
  });

  const cfg = {
    language:'lua', theme:'redfox', automaticLayout:true,
    wordWrap:'on', minimap:{enabled:true}, fontLigatures:true,
    fontFamily:'Roboto Mono'
  };

  inputEditor = monaco.editor.create(document.getElementById('input-editor'), {...cfg, value:'-- Paste your Luau script here...'});
  outputEditor = monaco.editor.create(document.getElementById('output-editor'), {...cfg, readOnly:true, value:'-- Obfuscated output will appear here.'});
  rawViewerEditor = monaco.editor.create(document.getElementById('raw-viewer-container'), {...cfg, readOnly:true});
  loaderViewerEditor = monaco.editor.create(document.getElementById('loader-viewer-container'), {...cfg, readOnly:true});

  document.getElementById('obfuscateBtn').disabled = false;
  showToast('RedFox Studio Ready!','success');
});

/* ---------- UI Helpers ---------- */
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('obfuscateBtn').addEventListener('click', obfuscateLuau);
  document.getElementById('copyObfBtn').addEventListener('click', () => copyMonacoContent(outputEditor,'Obfuscated script copied!'));
  document.getElementById('copyright-year').textContent = new Date().getFullYear();
});

function showTab(id, btn) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
  document.getElementById(id).style.display = 'block';
  btn?.classList.add('active');
}
function showToast(msg, type='info'){
  const t=document.getElementById('toast'), i=document.getElementById('toast-icon'), m=document.getElementById('toast-msg');
  m.textContent=msg; t.className='toast show '+type;
  const icons={success:'ph-duotone ph-check-circle',error:'ph-duotone ph-x-circle',info:'ph-duotone ph-info'};
  i.className=icons[type]||icons.info;
  setTimeout(()=>t.classList.remove('show'),3000);
}
function copyMonacoContent(ed,msg){
  const code=ed.getValue().trim();
  if(!code || code.startsWith('--')) return showToast('Nothing to copy!','error');
  navigator.clipboard.writeText(code).then(()=>showToast(msg,'success'),()=>showToast('Copy failed!','error'));
}

/* ---------- OBFUSCATOR CORE (fixed) ---------- */
const RESERVED = new Set(['and','break','do','else','elseif','end','false','for','function','if','in','local','nil','not','or','repeat','return','then','true','until','while','game','workspace','script','print','wait','task','Instance','Vector3','CFrame','Color3','UDim2','BrickColor','Enum','os','math','string','table','coroutine','bit32','utf8','debug','getfenv','setfenv','rawget','rawset','rawlen','select','tonumber','tostring','type','unpack','pairs','ipairs','next','pcall','xpcall','loadstring','spawn','delay','wait']);
function randName(){const c='Il';let s='_';for(let i=0;i<12;i++)s+=c[Math.floor(Math.random()*c.length)];return s;}
function randKey(len=20){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let s='';for(let i=0;i<len;i++)s+=c[Math.floor(Math.random()*c.length)];return s;}

function buildScopeAST(code){return luaparse.parse(code,{scope:true,locations:true,ranges:true,luaVersion:'5.3'});}

function renameVariables(ast){
  const map=new Map(),used=new Set(RESERVED);
  function uniq(){let n;do n=randName();while(used.has(n));used.add(n);return n;}
  function walk(node){
    if(!node) return;
    if(node.scope){for(const name in node.scope.locals){if(!RESERVED.has(name))map.set(name,uniq());}}
    for(const k in node){const c=node[k];if(Array.isArray(c))c.forEach(walk);else if(c && typeof c==='object')walk(c);}
  }
  walk(ast); return map;
}

function genNode(n){
  if(!n) return '';
  switch(n.type){
    case'Identifier':return n.name;
    case'StringLiteral':return`"${n.value.replace(/"/g,'\\"')}"`;
    case'NumericLiteral':return n.raw||n.value;
    case'BooleanLiteral':return n.raw||String(n.value);
    case'NilLiteral':return'nil';
    case'VarargLiteral':return'...';
    case'LocalStatement':return`local ${n.variables.map(genNode).join(', ')}${n.init.length>0?' = '+n.init.map(genNode).join(', '):''}`;
    case'AssignmentStatement':return`${n.variables.map(genNode).join(', ')} = ${n.init.map(genNode).join(', ')}`;
    case'CallStatement':return genNode(n.expression);
    case'BinaryExpression':return`(${genNode(n.left)} ${n.operator} ${genNode(n.right)})`;
    case'UnaryExpression':return`${n.operator} ${genNode(n.argument)}`;
    case'CallExpression':return`${genNode(n.base)}(${(n.arguments||[]).map(genNode).join(',')})`;
    case'MemberExpression':return n.indexed?`${genNode(n.base)}[${genNode(n.identifier)}]`:`${genNode(n.base)}.${genNode(n.identifier)}`;
    case'ReturnStatement':return`return ${n.arguments.map(genNode).join(',')}`;
    default:return'';
  }
}

/* Control-flow flattening is left as a placeholder – it does not break the script */
function flattenControlFlow(ast){return ast.body.map(genNode).join('\n');}

/* Number obfuscation – safe for small numbers */
function obfuscateNumbers(code){
  return code.replace(/\b(\d+(\.\d+)?)\b/g,numStr=>{
    const v=parseFloat(numStr);
    if(Math.abs(v)<2||Math.random()<0.25) return numStr;
    const a=Math.random()*v, b=v-a;
    return Math.random()>0.5?`(${a}+${b})`:`(${v+a}-${a})`;
  });
}

/* String encryption */
function encryptStringsMax(code,key,decName){
  return code.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,lit=>{
    const raw=lit.slice(1,-1);
    if(!raw) return lit;
    let xor='';for(let i=0;i<raw.length;i++)xor+=String.fromCharCode(raw.charCodeAt(i)^key.charCodeAt(i%key.length));
    return `${decName}("${btoa(xor)}")`;
  });
}
function decoderMax(key,name){
  const b64=`local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
function B64_DECODE(d) d=d:gsub('[^'..b..']','') return (d:gsub('.',function(x)if x=='='then return ''end local r,f='',(b:find(x)-1)for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and'1'or'0')end return r end):gsub('%d%d%d?%d?%d?%d?%d?%d?',function(x)if #x~=8 then return ''end local c=0 for i=1,8 do c=c+(x:sub(i,i)=='1'and 2^(8-i)or 0)end return string.char(c)end))end`;
  return `local C,D='${key}',(string.char) ${b64} local function ${name}(F)local G,H="",B64_DECODE(F)for I=1,#H do G=G..D(H:byte(I)~C:byte((I-1)%#C+1))end return G end`;
}

/* Junk & anti-debug */
function injectJunk(){
  const cnt=300+Math.floor(Math.random()*200);
  let j='';for(let i=0;i<cnt;i++){const op=['+','-','*','/'][Math.floor(Math.random()*4)];const a=Math.floor(Math.random()*100)+1;const b=Math.floor(Math.random()*100)+1;j+=`local ${randName()}=${a}${op}${b};`;}
  return j;
}
function antiDebugMax(){return`task.spawn(function()local a=os.clock()while task.wait(0.3)do if os.clock()-a>1 then getfenv().debug=nil;error('Debugger detected',0)end a=os.clock()end end)`;}

/* Anti-tamper (hash placeholder) */
function antiTamper(){return`local HASH_PLACEHOLDER="%%SCRIPT_HASH%%"
local info=debug.getinfo(1,"S")
if info.source:sub(1,1)=="@" then
  local f=io.open(info.source:sub(2),"rb")
  if f then
    local c=f:read("*a") f:close()
    local h=0 for i=1,#c do h=(h*31+string.byte(c,i))%0xFFFFFFFF end
    if tostring(h)~="HASH_PLACEHOLDER" then error("Tampered script") end
  end
end`;}
function djb2Hash(str){let h=5381;for(let i=0;i<str.length;i++)h=(h*33)^str.charCodeAt(i);return (h>>>0).toString();}

/* Minify */
function minifyMax(code){return code.replace(/--\[\[[\s\S]*?\]\]/g,'').replace(/--[^\n]*/g,'').replace(/\s+/g,' ').replace(/\s*([=+\-*/%^#<>(){}\[\].,;:])\s*/g,'$1').trim();}

/* Full obfuscation pipeline */
function fullObfuscate(src,opts){
  let out=src;
  if(opts.antiDebug) out=antiDebugMax()+'\n'+out;
  if(opts.junk) out=injectJunk()+out;
  const ast=buildScopeAST(out);
  const varMap=opts.variableRenaming?renameVariables(ast):new Map();
  if(opts.variableRenaming){
    const reps=[];function collect(n){if(!n)return;if(n.type==='Identifier'&&varMap.has(n.name)&&n.range)reps.push({s:n.range[0],e:n.range[1],to:varMap.get(n.name)});for(const k in n){const c=n[k];if(Array.isArray(c))c.forEach(collect);else if(c&&typeof c==='object')collect(c);}}
    collect(ast);reps.sort((a,b)=>b.s-a.s);
    for(const r of reps) out=out.slice(0,r.s)+r.to+out.slice(r.e);
  }
  if(opts.numberObf) out=obfuscateNumbers(out);
  let decoder='';if(opts.encryptStrings){const key=randKey(24),dec=randName();decoder=decoderMax(key,dec);out=encryptStringsMax(out,key,dec);}
  if(opts.antiTamper) out=antiTamper()+'\n'+out;
  out=`${decoder}\n${out}`;
  if(opts.antiTamper){const hash=djb2Hash(out);out=out.replace('%%SCRIPT_HASH%%',hash);}
  if(opts.minify) out=minifyMax(out);
  return`-- Obfuscated by RedFox Studio | https://discord.gg/redfox\n${out}`;
}

/* Obfuscate button */
async function obfuscateLuau(){
  const src=inputEditor.getValue().trim();
  if(!src||src.startsWith('-- Paste')) return showToast('Paste a script first','error');
  const opts={
    encryptStrings:document.getElementById('opt-str-encrypt').checked,
    variableRenaming:document.getElementById('opt-var-rename').checked,
    antiDebug:document.getElementById('opt-anti-debug').checked,
    minify:document.getElementById('opt-minify').checked,
    controlFlow:document.getElementById('opt-control-flow').checked,
    numberObf:document.getElementById('opt-num-obf').checked,
    junk:document.getElementById('opt-junk-code').checked,
    antiTamper:document.getElementById('opt-anti-tamper').checked
  };
  showToast('Obfuscating…','info');
  outputEditor.setValue('-- Working...');
  await new Promise(r=>setTimeout(r,50));
  try{
    const result=fullObfuscate(src,opts);
    outputEditor.setValue(result);
    showToast('Obfuscation complete!','success');
  }catch(e){
    outputEditor.setValue(`-- ERROR: ${e.message}`);
    showToast('Error: '+e.message,'error');
    console.error(e);
  }
}

/* Modal script loader */
async function showScriptModal(name,url){
  document.getElementById('modalScriptName').textContent=name;
  document.getElementById('scriptModal').classList.add('visible');
  loaderViewerEditor.setValue(`-- Loader:\nloadstring(game:HttpGet("${url}"))()`);
  rawViewerEditor.setValue('-- Fetching...');
  try{
    const proxy=`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
    const r=await fetch(proxy);
    if(!r.ok) throw new Error(r.status);
    const txt=await r.text();
    rawViewerEditor.setValue(txt);
    inputEditor.setValue(txt);
  }catch(e){
    rawViewerEditor.setValue(`-- Failed: ${e.message}`);
  }
}
function closeScriptModal(){document.getElementById('scriptModal').classList.remove('visible');}
</script>
</body>
</html>
