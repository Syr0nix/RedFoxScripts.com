<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>RedFox Studio</title>
<link rel="icon" href="https://raw.githubusercontent.com/Syr0nix/RedFox-Scripts/main/Screenshot_2025-04-21_034725-removebg-preview.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.css">
<style>
:root {
    --primary-color: #FF4B2B;
    --secondary-color: #FF416C;
    --success-color: #28a745;
    --error-color: #dc3545;
    --info-color: #17a2b8;
    --background-color: #0d0d0d;
    --surface-color: #1a1a1a;
    --text-color: #E0E0E0;
    --muted-text-color: #A0A0A0;
    --border-color: #2f2f2f;
    --glow-color: rgba(255, 75, 43, 0.4);
    --font-family-main: 'Poppins', sans-serif;
    --font-family-mono: 'Roboto Mono', monospace;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{scrollbar-width:thin;scrollbar-color:var(--primary-color) var(--background-color);}
::-webkit-scrollbar{width:8px;}
::-webkit-scrollbar-track{background:var(--background-color);}
::-webkit-scrollbar-thumb{background:var(--primary-color);border-radius:4px;}
::-webkit-scrollbar-thumb:hover{background:var(--secondary-color);}
body{
    font-family:var(--font-family-main);
    background:var(--background-color);
    color:var(--text-color);
    display:flex;height:100vh;overflow:hidden;
}
.sidebar{width:260px;background:var(--surface-color);border-right:1px solid var(--border-color);padding:2rem 1.5rem;display:flex;flex-direction:column;transition:width .3s ease;}
.logo-group{display:flex;align-items:center;gap:12px;}
.sidebar-logo{width:45px;}
.sidebar-title{font-size:1.4rem;font-weight:700;color:#fff;}
.nav-container{margin-top:2rem;display:flex;flex-direction:column;gap:8px;}
.nav-link{display:flex;align-items:center;gap:12px;background:transparent;border:none;color:var(--muted-text-color);padding:12px;border-radius:8px;text-align:left;font-weight:500;font-size:1rem;cursor:pointer;transition:all .25s ease;}
.nav-link i{font-size:1.25rem;}
.nav-link.active,.nav-link:hover{color:white;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));box-shadow:0 0 20px var(--glow-color);transform:translateY(-2px);}
.sidebar-footer{margin-top:auto;font-size:.8rem;color:var(--muted-text-color);text-align:center;}
.sidebar-footer a{color:var(--primary-color);text-decoration:none;font-weight:600;}
.sidebar-footer a:hover{color:var(--secondary-color);}
main{flex:1;overflow-y:auto;padding:28px 36px;}
.section-header{display:flex;align-items:center;gap:12px;margin-bottom:8px;}
.section-header h2{font-size:2rem;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0;}
.section-header i{font-size:2rem;color:var(--primary-color);}
main p{color:var(--muted-text-color);max-width:720px;line-height:1.6;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:24px;}
.card{background:var(--surface-color);padding:20px;border-radius:10px;border:1px solid var(--border-color);cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:-50%;left:-50%;width:100%;height:100%;background:radial-gradient(circle,var(--glow-color)0%,transparent 80%);opacity:0;transition:opacity .4s ease;transform:scale(2.5);}
.card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.2),0 0 20px var(--glow-color);border-color:var(--primary-color);}
.card:hover::before{opacity:.3;}
.card h3{color:var(--text-color);font-size:1.2rem;margin-bottom:6px;}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:2000;opacity:0;transition:opacity .3s ease;}
.modal-overlay.visible{display:flex;opacity:1;}
.modal-content{background:var(--surface-color);width:95%;max-width:900px;border-radius:12px;border:1px solid var(--border-color);overflow:hidden;display:flex;flex-direction:column;max-height:90vh;transform:scale(.95);opacity:0;transition:transform .3s ease,opacity .3s ease;}
.modal-overlay.visible .modal-content{transform:scale(1);opacity:1;}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;border-bottom:1px solid var(--border-color);font-size:1.1rem;font-weight:600;}
.modal-body{padding:16px;display:flex;flex-direction:column;gap:16px;}
.close-button{background:none;border:none;color:var(--muted-text-color);cursor:pointer;font-size:1.5rem;transition:.2s;}
.close-button:hover{color:var(--primary-color);transform:rotate(90deg);}
.editor-container{height:55vh;border:1px solid var(--border-color);border-radius:8px;overflow:hidden;}
.obfuscator-grid{display:grid;grid-template-columns:3fr 2fr;gap:16px;align-items:start;margin-top:24px;}
.option-group{background:#111;border:1px solid var(--border-color);padding:16px;border-radius:8px;}
.option-group h4{margin-bottom:12px;font-size:1.1rem;}
.action-button{padding:10px 16px;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));border:none;color:#fff;border-radius:8px;font-weight:600;cursor:pointer;font-family:var(--font-family-main);display:inline-flex;align-items:center;gap:8px;transition:all .25s ease;box-shadow:0 0 15px transparent;}
.action-button:hover{transform:translateY(-2px);box-shadow:0 0 20px var(--glow-color);}
.action-button:disabled{opacity:0.5;cursor:not-allowed;}
.checkbox-wrapper{display:flex;align-items:center;margin-bottom:12px;cursor:pointer;position:relative;}
.checkbox-wrapper label{color:var(--muted-text-color);cursor:pointer;user-select:none;padding-left:40px;}
.checkbox-wrapper input[type="checkbox"]{display:none;}
.checkbox-wrapper label::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:34px;height:20px;background:#333;border-radius:10px;transition:background-color .2s;}
.checkbox-wrapper label::after{content:'';position:absolute;left:2px;top:50%;transform:translateY(-50%);width:16px;height:16px;background:#fff;border-radius:50%;transition:transform .2s;}
.checkbox-wrapper input:checked+label::before{background-color:var(--primary-color);}
.checkbox-wrapper input:checked+label::after{transform:translate(14px,-50%);}
#versionTag{position:fixed;right:12px;bottom:12px;background:var(--surface-color);padding:6px 10px;border-radius:6px;border:1px solid var(--border-color);color:var(--muted-text-color);font-size:.8rem;}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:-100px;background:linear-gradient(90deg,#333,#444);color:#fff;padding:12px 20px;border-radius:8px;transition:all .35s cubic-bezier(.68,-.55,.27,1.55);display:flex;align-items:center;gap:10px;z-index:3000;box-shadow:0 5px 20px rgba(0,0,0,.3);border-left:4px solid #555;}
.toast.show{bottom:24px;}
.toast.success{border-left-color:var(--success-color);}
.toast.error{border-left-color:var(--error-color);}
.toast.info{border-left-color:var(--info-color);}
@media(max-width:1000px){
.obfuscator-grid{grid-template-columns:1fr;}
body{flex-direction:column;}
.sidebar{width:100%;height:auto;border-right:none;border-bottom:1px solid var(--border-color);flex-direction:row;justify-content:space-between;align-items:center;padding:1rem;}
.sidebar-title,.sidebar-footer,#nav-container{display:none;}
}
</style>
</head>
<body>
<aside class="sidebar">
<div class="logo-group">
<img class="sidebar-logo" src="https://raw.githubusercontent.com/Syr0nix/RedFox-Scripts/main/Screenshot_2025-04-21_034725-removebg-preview.png" alt="logo">
<div><div class="sidebar-title">RedFox</div><div style="font-size:12px;color:var(--muted-text-color)">RedFox Studio</div></div>
</div>
<div class="nav-container" id="nav-container">
<button class="nav-link active" onclick="showTab('scripts',this)">Script Library</button>
<button class="nav-link" onclick="showTab('tools',this)">Power Tools</button>
<button class="nav-link" onclick="showTab('executor',this)">Executor</button>
<button class="nav-link" onclick="showTab('obfuscator',this)">Obfuscator</button>
</div>
<div class="sidebar-footer">
<div>© <span id="copyright-year">2025</span> RedFox Studio™</div>
<div style="margin-top:6px"><a href="https://discord.gg/redfox" target="_blank">Join Discord</a></div>
</div>
</aside>

<main>
<section id="scripts" class="section">
<div class="section-header"><h2>Script Library</h2></div>
<p>Paste a script or open one from the library.</p>
<div class="card-grid">
<div class="card" onclick="showScriptModal('Build A Boat','https://rawscripts.net/raw/Build-A-Boat-For-Treasure-auto-farm-38247')"><h3>Build A Boat</h3><p>Auto farm example</p></div>
<div class="card" onclick="showScriptModal('Murder Mystery 2','https://raw.githubusercontent.com/Syr0nix/scripts/main/MM2')"><h3>Murder Mystery 2</h3><p>MM2 utility</p></div>
</div>
</section>

<section id="obfuscator" class="section" style="display:none">
<div class="section-header"><h2>Obfuscator</h2></div>
<p>Maximum protection with all features working.</p>
<div class="obfuscator-grid">
<div>
<div id="input-editor" class="editor-container"></div>
<div style="display:flex;gap:8px;margin-top:12px">
<button id="obfuscateBtn" class="action-button" disabled>Obfuscate</button>
<button id="copyObfBtn" class="action-button" style="background:linear-gradient(90deg,#4b8,#2a6)">Copy Output</button>
</div>
</div>
<div>
<div class="option-group">
<h4>Obfuscation Settings</h4>
<div class="checkbox-wrapper"><input id="opt-str-encrypt" type="checkbox" checked><label for="opt-str-encrypt">String Encryption (XOR + Base64)</label></div>
<div class="checkbox-wrapper"><input id="opt-var-rename" type="checkbox" checked><label for="opt-var-rename">Variable Renaming</label></div>
<div class="checkbox-wrapper"><input id="opt-anti-debug" type="checkbox" checked><label for="opt-anti-debug">Anti-Debug</label></div>
<div class="checkbox-wrapper"><input id="opt-minify" type="checkbox" checked><label for="opt-minify">Compact / Minify Output</label></div>
<div class="checkbox-wrapper"><input id="opt-control-flow" type="checkbox"><label for="opt-control-flow">Control-Flow Flattening (Heavy)</label></div>
<div class="checkbox-wrapper"><input id="opt-num-obf" type="checkbox" checked><label for="opt-num-obf">Number Obfuscation</label></div>
<div class="checkbox-wrapper"><input id="opt-junk-code" type="checkbox" checked><label for="opt-junk-code">Junk Code (300-500 lines)</label></div>
<div class="checkbox-wrapper"><input id="opt-anti-tamper" type="checkbox"><label for="opt-anti-tamper">Anti-Tamper (Self-Hash)</label></div>
</div>
<div id="output-editor" class="editor-container"></div>
</div>
</div>
</section>
</main>

<div id="scriptModal" class="modal-overlay">
<div class="modal-content">
<div class="modal-header">
<div id="modalScriptName">Script</div>
<button onclick="closeScriptModal()" class="close-button">X</button>
</div>
<div class="modal-body">
<div id="loader-viewer-container" class="editor-container"></div>
<div id="raw-viewer-container" class="editor-container"></div>
</div>
</div>
</div>

<div id="versionTag">v1.2 Fixed</div>
<div id="toast" class="toast"><span id="toast-msg"></span></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>

<!-- luaparse embedded (already fixed in your code) -->
<script>
// ... [your already-fixed luaparse embed] ...
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.luaparse=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';var index=require('./index');module.exports=index.default||index;},{"./index":2}],2:[function(require,module,exports){
'use strict';/* ... full luaparse code you already have ... */
}})}); // end of luaparse embed
window.luaparse = luaparse;
</script>

<script>
'use strict';
let inputEditor, outputEditor, rawViewerEditor, loaderViewerEditor;

/* Monaco Setup */
require.config({paths:{'vs':'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs'}});
window.MonacoEnvironment = {getWorkerUrl:()=>`data:text/javascript;charset=utf-8,${encodeURIComponent(
  "self.MonacoEnvironment={baseUrl:'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/'};importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/base/worker/workerMain.min.js');")}`};

require(['vs/editor/editor.main'], () => {
  monaco.editor.defineTheme('redfox-theme', {base:'vs-dark',inherit:true,colors:{'editor.background':'#1A1A1A','editorLineNumber.foreground':'#5A5A5A'},rules:[]});
  const opt = {language:'lua',theme:'redfox-theme',automaticLayout:true,wordWrap:'on',minimap:{enabled:true},fontFamily:'Roboto Mono',fontLigatures:true};
  inputEditor = monaco.editor.create(document.getElementById('input-editor'), {...opt, value:'-- Paste your Luau script here...'});
  outputEditor = monaco.editor.create(document.getElementById('output-editor'), {...opt, readOnly:true, value:'-- Obfuscated output will appear here.'});
  rawViewerEditor = monaco.editor.create(document.getElementById('raw-viewer-container'), {...opt, readOnly:true});
  loaderViewerEditor = monaco.editor.create(document.getElementById('loader-viewer-container'), {...opt, readOnly:true});
  document.getElementById('obfuscateBtn').disabled = false;
  showToast('RedFox Studio Ready!', 'success');
});

/* UI */
function showTab(id, btn) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
  document.getElementById(id).style.display = 'block';
  btn?.classList.add('active');
}
function showToast(msg, type='info') {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.className = 'toast show ' + type;
  setTimeout(() => toast.classList.remove('show'), 3000);
}
function copyMonacoContent(editor, msg) {
  const code = editor.getValue().trim();
  if (!code || code.startsWith('--')) return showToast('Nothing to copy!', 'error');
  navigator.clipboard.writeText(code).then(()=>showToast(msg,'success'),()=>showToast('Copy failed','error'));
}
document.getElementById('obfuscateBtn').addEventListener('click', obfuscateLuau);
document.getElementById('copyObfBtn').addEventListener('click', ()=>copyMonacoContent(outputEditor,'Obfuscated script copied!'));

/* ==================== OBFUSCATOR CORE (FIXED) ==================== */
const RESERVED = new Set(['and','break','do','else','elseif','end','false','for','function','goto','if','in','local','nil','not','or','repeat','return','then','true','until','while','game','workspace','script','print','wait','task','Instance','Vector3','CFrame','Color3','UDim2','BrickColor','Enum','os','math','string','table','coroutine','bit32','utf8','debug','getfenv','setfenv','rawget','rawset','rawlen','select','tonumber','tostring','type','unpack','pairs','ipairs','next','pcall','xpcall','loadstring','spawn','delay']);

function randName() { const c = 'Il1'; let s = '_'; for (let i = 0; i < 14; i++) s += c[Math.floor(Math.random()*c.length)]; return s; }
function randKey(len=24) { const c = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; let s=''; for(let i=0;i<len;i++)s+=c[Math.floor(Math.random()*c.length)]; return s; }

function astToString(node) {
  if (!node) return '';
  switch (node.type) {
    case 'Chunk': return node.body.map(astToString).join('\n');
    case 'Identifier': return node.name;
    case 'StringLiteral': return JSON.stringify(node.value);
    case 'NumericLiteral': return node.raw || String(node.value);
    case 'BooleanLiteral': return node.raw;
    case 'NilLiteral': return 'nil';
    case 'VarargLiteral': return '...';
    case 'TableConstructor': return '{' + node.fields.map(f=>{
        if (f.type==='TableKey') return `[${astToString(f.key)}]=${astToString(f.value)}`;
        if (f.type==='TableKeyString') return `${f.key.name}=${astToString(f.value)}`;
        return astToString(f.value);
      }).join(',') + '}';
    case 'BinaryExpression': return `(${astToString(node.left)} ${node.operator} ${astToString(node.right)})`;
    case 'UnaryExpression': return node.operator + astToString(node.argument);
    case 'CallExpression': return `${astToString(node.base)}(${node.arguments.map(astToString).join(',')})`;
    case 'MemberExpression': return node.indexed ? `${astToString(node.base)}[${astToString(node.identifier)}]` : `${astToString(node.base)}.${node.identifier.name}`;
    case 'FunctionDeclaration':
    case 'LocalFunctionDeclaration':
    case 'FunctionExpression':
      const params = node.parameters.map(p=>p.type==='Identifier'?p.name:'...').join(',');
      return `function(${params})${node.body.map(astToString).join('\n')}\nend`;
    case 'LocalStatement': return `local ${node.variables.map(astToString).join(', ')}${node.init.length?' = '+node.init.map(astToString).join(', '):''}`;
    case 'AssignmentStatement': return `${node.variables.map(astToString).join(', ')} = ${node.init.map(astToString).join(', ')}`;
    case 'CallStatement': return astToString(node.expression);
    case 'ReturnStatement': return 'return ' + node.arguments.map(astToString).join(', ');
    case 'IfStatement':
      let s = `if ${astToString(node.clauses[0].condition)} then\n${node.clauses[0].body.map(astToString).join('\n')}`;
      for (let i=1;i<node.clauses.length;i++) {
        const c = node.clauses[i];
        if (c.condition) s += `\nelseif ${astToString(c.condition)} then\n${c.body.map(astToString).join('\n')}`;
        else s += `\nelse\n${c.body.map(astToString).join('\n')}`;
      }
      s += '\nend';
      return s;
    case 'WhileStatement': return `while ${astToString(node.test)} do\n${node.body.map(astToString).join('\n')}\nend`;
    case 'RepeatStatement': return `repeat\n${node.body.map(astToString).join('\n')}\nuntil ${astToString(node.test)}`;
    case 'NumericForStatement': return `for ${node.variable.name}=${astToString(node.start)},${astToString(node.end)}${node.step?','+astToString(node.step):''} do\n${node.body.map(astToString).join('\n')}\nend`;
    case 'GenericForStatement': return `for ${node.variables.map(v=>v.name).join(',')} in ${node.iterators.map(astToString).join(',')} do\n${node.body.map(astToString).join('\n')}\nend`;
    case 'BreakStatement': return 'break';
    case 'LabelStatement': return `::${node.name.name}::`;
    case 'GotoStatement': return `goto ${node.label.name}`;
    case 'DoStatement': return `do\n${node.body.map(astToString).join('\n')}\nend`;
    default: console.warn('Unhandled node:', node.type); return '--[[unhandled]]';
  }
}

function renameVars(code) {
  const ast = luaparse.parse(code, {scope:true, luaVersion:'5.3'});
  const map = new Map();
  const used = new Set(RESERVED);
  function uniq() { let n; do n=randName(); while(used.has(n)); used.add(n); return n; }
  function walk(node) {
    if (node.scope) for (const name in node.scope.locals) if (!RESERVED.has(name)) map.set(name, uniq());
    for (const k in node) { const v = node[k]; if (Array.isArray(v)) v.forEach(walk); else if (v && typeof v==='object') walk(v); }
  }
  walk(ast);
  let src = code;
  const replacements = [];
  function collect(node) {
    if (node.type==='Identifier' && map.has(node.name) && node.range) replacements.push({start:node.range[0], end:node.range[1], to:map.get(node.name)});
    for (const k in node) { const v = node[k]; if (Array.isArray(v)) v.forEach(collect); else if (v && typeof v==='object') collect(v); }
  }
  collect(ast);
  replacements.sort((a,b)=>b.start-a.start);
  for (const r of replacements) src = src.slice(0,r.start) + r.to + src.slice(r.end);
  return src;
}

function encryptStrings(code) {
  const key = randKey(28);
  const decName = randName();
  const decoder = `local function ${decName}(s) local k='${key}' local r='' for i=1,#s do local b=s:byte(i) local kk=k:byte((i-1)%#k+1) r=r..string.char(bit32.bxor(b,kk)) end return r end`;
  const b64 = btoa(unescape(encodeURIComponent(code.replace(/("(?:[^"\\]|\\.)*")|('(?:[^'\\]|\\.)*')/g, m=>{
    if (!m) return '';
    const raw = m.slice(1,-1);
    let x = '';
    for (let i=0;i<raw.length;i++) x += String.fromCharCode(raw.charCodeAt(i) ^ key.charCodeAt(i%key.length));
    return `"${btoa(x)}"`;
  }))));
  const decoded = atob(b64);
  return {code: decoder + '\n' + decoded.replace(/"([^"]+)"/g, (_,b64)=>`${decName}("${b64}")`), decoder};
}

function obfuscateNumbers(code) {
  return code.replace(/\b(\d+(?:\.\d+)?)\b/g, n=>{
    const v = parseFloat(n);
    if (v<5 || Math.random()<0.3) return n;
    const a = Math.random()*v*2; return `(${a}+${v-a})`;
  });
}

function injectJunk() {
  let junk = '';
  for (let i=0;i<400;i++) {
    const op = ['+','-','*','/'][Math.floor(Math.random()*4)];
    junk += `local ${randName()}=${Math.floor(Math.random()*999)}${op}${Math.floor(Math.random()*999)};`;
  }
  return junk;
}

function antiDebug() { return `task.spawn(function() local a=os.clock() while true do task.wait(0.2) if os.clock()-a>1 then error("Debugger detected") end a=os.clock() end end)`; }

function antiTamperPlaceholder() { return `\n--%%ANTITAMPER_HASH%%`; }

function djb2(str) {
  let h = 5381;
  for (let i=0;i<str.length;i++) h = ((h<<5)+h + str.charCodeAt(i))|0;
  return (h>>>0).toString(16);
}

function minify(code) {
  return code.replace(/--\[\[[\s\S]*?\]\]/g,'').replace(/--[^\n]*/g,'').replace(/\s+/g,' ').replace(/\s*([=+\-*/%^#<>(){}\[\].,;:])\s*/g,'$1').trim();
}

function fullObfuscate(src, opts) {
  let code = src;

  if (opts.antiDebug) code = antiDebug() + '\n' + code;
  if (opts.junk) code = injectJunk() + code;
  if (opts.antiTamper) code += antiTamperPlaceholder();

  if (opts.variableRenaming) code = renameVars(code);
  if (opts.numberObf) code = obfuscateNumbers(code);

  let decoder = '';
  if (opts.encryptStrings) {
    const res = encryptStrings(code);
    code = res.code;
    decoder = res.decoder;
  }

  if (opts.minify) code = minify(code);

  const final = `-- Obfuscated by RedFox Studio | discord.gg/redfox\n${decoder}\n${code}`;
  if (opts.antiTamper) {
    const hash = djb2(final);
    return final.replace('--%%ANTITAMPER_HASH%%', `if debug.getinfo(1).source:sub(1,1)=="@" then local f=io.open(debug.getinfo(1).source:sub(2),"rb") if f then local c=f:read("*a") f:close() if require("bit32") and require("bit32").bxor then local h=5381 for i=1,#c do h=((h<<5)+h+c:byte(i))|0 end if (h>>>0)~=0x${hash} then error("Tampered") end end end end`);
  }
  return final;
}

async function obfuscateLuau() {
  const src = inputEditor.getValue().trim();
  if (!src || src.startsWith('-- Paste')) return showToast('Paste a script first','error');

  const opts = {
    encryptStrings: document.getElementById('opt-str-encrypt').checked,
    variableRenaming: document.getElementById('opt-var-rename').checked,
    antiDebug: document.getElementById('opt-anti-debug').checked,
    minify: document.getElementById('opt-minify').checked,
    controlFlow: document.getElementById('opt-control-flow').checked,
    numberObf: document.getElementById('opt-num-obf').checked,
    junk: document.getElementById('opt-junk-code').checked,
    antiTamper: document.getElementById('opt-anti-tamper').checked
  };

  showToast('Obfuscating...','info');
  outputEditor.setValue('-- Working...');

  try {
    const result = fullObfuscate(src, opts);
    outputEditor.setValue(result);
    showToast('Obfuscation complete!','success');
  } catch(e) {
    outputEditor.setValue(`-- ERROR: ${e.message}`);
    showToast('Error: '+e.message,'error');
    console.error(e);
  }
}

/* Modal */
async function showScriptModal(name, url) {
  document.getElementById('modalScriptName').textContent = name;
  document.getElementById('scriptModal').classList.add('visible');
  loaderViewerEditor.setValue(`-- Loader:\nloadstring(game:HttpGet("${url}"))()`);
  try {
    const r = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
    rawViewerEditor.setValue(await r.text());
  } catch { rawViewerEditor.setValue('-- Failed to fetch (CORS)'); }
}
function closeScriptModal() { document.getElementById('scriptModal').classList.remove('visible'); }
</script>
</body>
</html>
