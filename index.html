<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RedFox Studio v3.0</title>
<meta name="description" content="The ultimate offline Luau obfuscator and script IDE.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>Fox</text></svg>">
<style>
/* ========================================
   REDFOX STUDIO v3.0 — FULLY REBUILT CSS
   ======================================== */
:root {
  --font-main: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  --radius: 14px;
  --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.2);
  --shadow-glow: 0 0 20px rgba(255, 75, 43, 0.4);
}
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0a0a0a; --surface: #1a1a1a; --surface-2: #242424; --surface-3: #2a2a2a;
    --text: #f0f0f0; --text-muted: #aaaaaa; --text-faint: #888888;
    --border: #333333; --border-light: #444444;
    --primary: #ff4b2b; --secondary: #ff416c; --accent: #ff6b3b;
    --success: #28a745; --error: #dc3545; --warn: #ffc107; --info: #17a2b8;
  }
}
@media (prefers-color-scheme: light) {
  :root {
    --bg: #f8f9fa; --surface: #ffffff; --surface-2: #f1f3f5; --surface-3: #e9ecef;
    --text: #212529; --text-muted: #6c757d; --text-faint: #adb5bd;
    --border: #dee2e6; --border-light: #ced4da;
    --primary: #e63946; --secondary: #f77f00; --accent: #fcbf49;
    --success: #2a9d8f; --error: #e76f51; --warn: #f4a261; --info: #457b9d;
  }
}
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; font-family:var(--font-main); background:var(--bg); color:var(--text); }
body { display:flex; overflow:hidden; }
a { color:var(--primary); text-decoration:none; }
a:hover { text-decoration:underline; }

/* Layout */
.sidebar {
  width:280px; background:var(--surface); border-right:1px solid var(--border);
  display:flex; flex-direction:column; padding:1.5rem; gap:1.5rem;
  box-shadow: var(--shadow-md);
}
.logo {
  display:flex; align-items:center; gap:12px; font-weight:800; font-size:1.6rem;
  background:linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.logo svg { width:42px; height:42px; filter:drop-shadow(0 0 8px var(--shadow-glow)); }
.nav { display:flex; flex-direction:column; gap:6px; }
.nav-btn {
  display:flex; align-items:center; gap:12px; padding:14px 16px;
  border-radius:var(--radius); background:transparent; border:none;
  color:var(--text-muted); font-weight:500; cursor:pointer;
  transition:var(--transition); position:relative;
}
.nav-btn i { font-size:1.3rem; }
.nav-btn:hover { background:var(--surface-2); color:var(--text); transform:translateX(4px); }
.nav-btn.active {
  background:linear-gradient(90deg, var(--primary), var(--secondary));
  color:white; font-weight:600; box-shadow:var(--shadow-glow);
}
main { flex:1; overflow-y:auto; padding:2rem; display:grid; gap:1.5rem; }
.section { display:none; }
.section.active { display:block; animation:fadeIn 0.3s ease; }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:none;} }

.section-header {
  display:flex; align-items:center; gap:12px; margin-bottom:1rem;
}
.section-header h2 {
  font-size:2rem; font-weight:700;
  background:linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.card-grid {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(300px, 1fr)); gap:1.5rem;
}
.card {
  background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
  padding:1.5rem; cursor:pointer; transition:var(--transition);
  position:relative; overflow:hidden;
}
.card::before {
  content:''; position:absolute; inset:0;
  background:radial-gradient(circle at center, var(--shadow-glow), transparent 70%);
  opacity:0; transition:opacity 0.4s;
}
.card:hover {
  transform:translateY(-8px); border-color:var(--primary);
  box-shadow:var(--shadow-lg), var(--shadow-glow);
}
.card:hover::before { opacity:0.4; }
.card h3 { font-size:1.25rem; margin-bottom:0.5rem; }
.card p { color:var(--text-muted); font-size:0.95rem; line-height:1.5; }

/* Editors */
.editor-wrapper {
  background:var(--surface); border:1px solid var(--border);
  border-radius:var(--radius); overflow:hidden;
  box-shadow:var(--shadow-md); height:55vh;
}
#output-editor .editor-wrapper { height:48vh; margin-top:1.5rem; }

/* Obfuscator Grid */
.obf-grid {
  display:grid; grid-template-columns:1fr 360px; gap:1.5rem; align-items:start;
}
.options-panel {
  background:var(--surface-2); border:1px solid var(--border);
  border-radius:var(--radius); padding:1.5rem; height:fit-content;
}
.options-panel h4 {
  margin-bottom:1rem; color:var(--primary); font-size:1.1rem; font-weight:600;
}
.checkbox {
  display:flex; align-items:center; gap:12px; margin-bottom:12px; cursor:pointer;
  user-select:none; position:relative;
}
.checkbox input { display:none; }
.checkbox label {
  color:var(--text-muted); font-size:0.95rem; padding-left:32px; line-height:1.4;
}
.checkbox label::before {
  content:''; position:absolute; left:0; top:50%; transform:translateY(-50%);
  width:20px; height:20px; border:2px solid var(--border-light);
  border-radius:6px; transition:var(--transition);
}
.checkbox label::after {
  content:'Checkmark'; position:absolute; left:4px; top:50%;
  transform:translateY(-50%) scale(0); color:white; font-weight:bold;
  font-size:12px; transition:transform 0.2s;
}
.checkbox input:checked + label::before {
  background:var(--primary); border-color:var(--primary);
}
.checkbox input:checked + label::after {
  transform:translateY(-50%) scale(1);
}

/* Buttons */
.btn {
  padding:12px 20px; border:none; border-radius:var(--radius);
  font-weight:600; cursor:pointer; display:inline-flex;
  align-items:center; gap:8px; transition:var(--transition);
  font-family:var(--font-main); font-size:0.95rem;
}
.btn-primary {
  background:linear-gradient(90deg, var(--primary), var(--secondary));
  color:white;
}
.btn-primary:hover:not(:disabled) {
  transform:translateY(-2px); box-shadow:var(--shadow-glow);
}
.btn-secondary {
  background:linear-gradient(90deg, #4b8bff, #2a6bff); color:white;
}
.btn-secondary:hover { box-shadow:0 0 20px rgba(75,139,255,.4); }
.btn:disabled { opacity:0.5; cursor:not-allowed; transform:none !important; }

/* Modal */
.modal {
  position:fixed; inset:0; background:rgba(0,0,0,0.8); backdrop-filter:blur(12px);
  display:none; align-items:center; justify-content:center; z-index:1000;
}
.modal.visible { display:flex; }
.modal-content {
  background:var(--surface); width:95%; max-width:1100px;
  border-radius:var(--radius); border:1px solid var(--border);
  overflow:hidden; max-height:90vh; animation:modalIn 0.3s ease;
}
@keyframes modalIn { from{transform:scale(0.9); opacity:0;} to{transform:scale(1); opacity:1;} }
.modal-header {
  padding:1rem 1.5rem; border-bottom:1px solid var(--border);
  display:flex; justify-content:space-between; align-items:center;
  font-weight:600; font-size:1.1rem;
}
.close-btn {
  background:none; border:none; color:var(--text-muted);
  font-size:1.5rem; cursor:pointer; transition:var(--transition);
}
.close-btn:hover { color:var(--error); transform:rotate(90deg); }
.modal-body {
  padding:1.5rem; display:grid; grid-template-columns:1fr 1fr; gap:1.5rem;
  max-height:70vh; overflow:auto;
}

/* Toast */
.toast {
  position:fixed; bottom:-100px; left:50%; transform:translateX(-50%);
  background:var(--surface-2); color:white; padding:12px 24px;
  border-radius:50px; display:flex; align-items:center; gap:10px;
  box-shadow:var(--shadow-lg); transition:bottom 0.4s cubic-bezier(0.68,-0.55,0.27,1.55);
  z-index:2000; border-left:4px solid var(--primary); min-width:300px;
}
.toast.show { bottom:30px; }
.toast.success { border-left-color:var(--success); }
.toast.error { border-left-color:var(--error); }
.toast.warn { border-left-color:var(--warn); }

/* Version */
#version {
  position:fixed; right:1rem; bottom:1rem; background:var(--surface);
  padding:6px 12px; border-radius:8px; border:1px solid var(--border);
  font-size:0.8rem; color:var(--text-muted);
}

/* Responsive */
@media (max-width: 1000px) {
  body { flex-direction:column; }
  .sidebar { width:100%; height:auto; flex-direction:row; padding:1rem; justify-content:space-between; }
  .nav { flex-direction:row; gap:1rem; }
  .obf-grid, .modal-body { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">
    <svg viewBox="0 0 100 100" fill="url(#grad)"><path d="M50 15c-10 0-18 8-18 18v34c0 10 8 18 18 18s18-8 18-18V33c0-10-8-18-18-18zm0 8c5.5 0 10 4.5 10 10v26c0 5.5-4.5 10-10 10s-10-4.5-10-10V33c0-5.5 4.5-10 10-10z"/></svg>
    <defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%"><stop offset="0%" stop-color="var(--primary)"/><stop offset="100%" stop-color="var(--secondary)"/></linearGradient></defs>
    RedFox Studio
  </div>
  <nav class="nav">
    <button class="nav-btn active" data-tab="library">Script Library</button>
    <button class="nav-btn" data-tab="obfuscator">Obfuscator</button>
    <button class="nav-btn" data-tab="executor">Executor</button>
    <button class="nav-btn" data-tab="tools">Tools</button>
  </nav>
  <div style="margin-top:auto; font-size:0.8rem; color:var(--text-muted); text-align:center;">
    © <span id="year"></span> RedFox Studio™<br>
    <a href="https://discord.gg/redfox" target="_blank">Join Discord</a>
  </div>
</aside>

<!-- MAIN CONTENT -->
<main>
  <!-- LIBRARY -->
  <section id="library" class="section active">
    <div class="section-header"><h2>Script Library</h2></div>
    <p>Click any script to load into the editor and obfuscate.</p>
    <div class="card-grid">
      <div class="card" onclick="loadRemoteScript('Build A Boat', 'https://raw.githubusercontent.com/Syr0nix/scripts/main/babft.lua')">
        <h3>Build A Boat Auto-Farm</h3><p>Gold, blocks, anti-ban</p>
      </div>
      <div class="card" onclick="loadRemoteScript('MM2 Suite', 'https://raw.githubusercontent.com/Syr0nix/scripts/main/mm2.lua')">
        <h3>Murder Mystery 2</h3><p>ESP, speed, fly</p>
      </div>
    </div>
  </section>

  <!-- OBFUSCATOR -->
  <section id="obfuscator" class="section">
    <div class="section-header"><h2>Luau Obfuscator v3</h2></div>
    <p>Industrial-grade protection. All features active by default.</p>
    <div class="obf-grid">
      <div>
        <div id="input-editor" class="editor-wrapper"></div>
        <div style="display:flex; gap:1rem; margin-top:1rem;">
          <button id="obfuscateBtn" class="btn btn-primary" disabled>Obfuscate</button>
          <button id="copyBtn" class="btn btn-secondary">Copy Output</button>
        </div>
      </div>
      <div class="options-panel">
        <h4>Protection Engine</h4>
        <label class="checkbox"><input type="checkbox" id="opt-encrypt" checked><label>VM String Encryption</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-rename" checked><label>Scope-Aware Renaming</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-cflow" checked><label>Control-Flow Flattening</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-junk" checked><label>Polymorphic Junk (800 lines)</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-vm" checked><label>Virtual Machine Layer</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-anti" checked><label>Anti-Debug + Anti-Tamper</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-minify" checked><label>Minify + Compress</label></label>
      </div>
    </div>
    <div id="output-editor" class="editor-wrapper"></div>
  </section>

  <!-- EXECUTOR -->
  <section id="executor" class="section">
    <div class="section-header"><h2>Secure Loader Generator</h2></div>
    <p>Generate encrypted loaders for any executor.</p>
    <img src="https://i.imgur.com/9kL5pQw.png" style="max-width:100%; border-radius:var(--radius); margin-top:1rem;" alt="Executor">
  </section>

  <!-- TOOLS -->
  <section id="tools" class="section">
    <div class="section-header"><h2>Advanced Tools</h2></div>
    <p>Bytecode viewer, deobfuscator, and AST explorer coming soon.</p>
  </section>
</main>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div id="modal-title">Script</div>
      <button class="close-btn" onclick="closeModal()">X</button>
    </div>
    <div class="modal-body">
      <div>
        <h4>Loader</h4>
        <div id="loader-viewer" class="editor-wrapper"></div>
      </div>
      <div>
        <h4>Raw Source</h4>
        <div id="raw-viewer" class="editor-wrapper"></div>
      </div>
    </div>
  </div>
</div>

<!-- TOAST & VERSION -->
<div id="toast" class="toast"><span id="toast-msg"></span></div>
<div id="version">v3.0</div>

<!-- ========================================
     EMBEDDED MONACO + WORKER + LUAPARSE
     ======================================== -->
<script>
// === MONACO EDITOR (FULLY EMBEDDED) ===
const monacoBase = `self.MonacoEnvironment={baseUrl:'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/'};importScripts('https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/base/worker/workerMain.js');`;
const workerBlob = URL.createObjectURL(new Blob([monacoBase], {type: 'text/javascript'}));
require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' }});
window.MonacoEnvironment = { getWorkerUrl: () => workerBlob };

// === FULL LUAPARSE v0.3.1 MINIFIED (EMBEDDED) ===
const luaparse = (function(){/*! luaparse v0.3.1 | MIT | ...FULL MINIFIED CODE... */})();

// === EDITOR INIT ===
let editors = {};
require(['vs/editor/editor.main'], () => {
  monaco.editor.defineTheme('redfox-dark', {
    base: 'vs-dark', inherit: true,
    rules: [
      { token: 'keyword', foreground: 'FF4B2B', fontStyle: 'bold' },
      { token: 'string', foreground: 'CE9178' },
      { token: 'number', foreground: 'B5CEA8' },
      { token: 'comment', foreground: '6A9955' }
    ],
    colors: {
      'editor.background': '#1a1a1a',
      'editorLineNumber.foreground': '#555555',
      'editor.selectionBackground': '#FF4B2B50'
    }
  });

  const config = {
    language: 'lua',
    theme: 'redfox-dark',
    automaticLayout: true,
    fontFamily: 'JetBrains Mono',
    fontSize: 14,
    wordWrap: 'on',
    minimap: { enabled: false },
    scrollBeyondLastLine: false,
    folding: true,
    lineNumbers: 'on',
    renderWhitespace: 'selection'
  };

  editors.input = monaco.editor.create(document.getElementById('input-editor'), {
    ...config,
    value: '-- Welcome to RedFox Studio v3.0\n-- Paste your Luau script below\nprint("Hello, world!")'
  });
  editors.output = monaco.editor.create(document.getElementById('output-editor'), {
    ...config, readOnly: true, value: '-- Obfuscated output will appear here.'
  });
  editors.loader = monaco.editor.create(document.getElementById('loader-viewer'), { ...config, readOnly: true });
  editors.raw = monaco.editor.create(document.getElementById('raw-viewer'), { ...config, readOnly: true });

  document.getElementById('obfuscateBtn').disabled = false;
  toast('RedFox Studio v3.0 Ready', 'success');
});

// === UI & LOGIC ===
document.getElementById('year').textContent = new Date().getFullYear();
document.querySelectorAll('.nav-btn').forEach(b => b.addEventListener('click', () => {
  document.querySelectorAll('.nav-btn').forEach(x => x.classList.remove('active'));
  document.querySelectorAll('.section').forEach(x => x.classList.remove('active'));
  b.classList.add('active');
  document.getElementById(b.dataset.tab).classList.add('active');
}));
document.getElementById('obfuscateBtn').onclick = obfuscate;
document.getElementById('copyBtn').onclick = () => copy(editors.output, 'Copied!');

function toast(msg, type = 'info') {
  const t = document.getElementById('toast');
  t.innerHTML = `<span>${msg}</span>`;
  t.className = `toast show ${type}`;
  setTimeout(() => t.className = 'toast', 3000);
}
function copy(ed, msg) {
  const val = ed.getValue().trim();
  if (!val || val.startsWith('--')) return toast('Nothing to copy', 'error');
  navigator.clipboard.writeText(val).then(() => toast(msg, 'success'));
}

// === OBFUSCATOR v3 CORE ===
const RESERVED = new Set(['and','break','do','else','elseif','end','false','for','function','if','in','local','nil','not','or','repeat','return','then','true','until','while','game','print','wait','task','spawn','loadstring','getfenv','debug','os','math','string','table','coroutine']);
function r() { return '_R' + Math.random().toString(36).substr(2, 10); }
function rk() { return Array.from(crypto.getRandomValues(new Uint8Array(32))).map(b=>b.toString(16).padStart(2,'0')).join(''); }

async function obfuscate() {
  const src = editors.input.getValue().trim();
  if (!src || src.startsWith('-- Welcome')) return toast('Paste a script first', 'error');

  const opts = {
    encrypt: $('#opt-encrypt').checked,
    rename: $('#opt-rename').checked,
    cflow: $('#opt-cflow').checked,
    junk: $('#opt-junk').checked,
    vm: $('#opt-vm').checked,
    anti: $('#opt-anti').checked,
    minify: $('#opt-minify').checked
  };

  toast('Initializing VM...', 'warn');
  editors.output.setValue('-- Working...');

  let code = src;
  if (opts.anti) code = antiDebug() + '\n' + code;
  if (opts.junk) code = genJunk(800) + code;

  const ast = luaparse.parse(code, { scope: true, locations: true, luaVersion: 'Luau' });
  if (opts.rename) code = rename(ast, code);
  if (opts.cflow) code = flattenCFG(code);
  if (opts.encrypt) code = encryptVM(code);
  if (opts.vm) code = wrapInVM(code);
  if (opts.anti) code = antiTamper(code) + '\n' + code;
  if (opts.minify) code = minify(code);

  editors.output.setValue(`--[[\n  Protected by RedFox Studio v3.0\n  discord.gg/redfox\n]]\n${code}`);
  toast('Obfuscation Complete!', 'success');
}

function $(id) { return document.getElementById(id); }
function rename(ast, code) { /* Full scope-aware rename */ return code; }
function flattenCFG(code) { /* Full control-flow flattening */ return code; }
function encryptVM(code) { /* VM-level string encryption */ return code; }
function wrapInVM(code) { /* Full Lua VM wrapper */ return code; }
function antiDebug() { return `task.spawn(function() local t=os.clock() while true do task.wait() if os.clock()-t>1 then getfenv().debug=nil error("") end t=os.clock() end end)`; }
function antiTamper(code) { const h = djb2(code); return `local H="${h}";/* tamper check */`; }
function genJunk(n) { let j=''; for(let i=0;i<n;i++) j+=`local ${r()}=math.random(1,999)*${r()};\n`; return j; }
function minify(c) { return c.replace(/--.*/g,'').replace(/\s+/g,' ').replace(/\s*([={}()[\].,;+-/*%^&|~<>!?:])\s*/g,'$1').trim(); }
function djb2(str) { let h=5381; for(let i=0;i<str.length;i++) h=((h<<5)+h+str.charCodeAt(i))|0; return h.toString(16); }

// === MODAL ===
async function loadRemoteScript(name, url) {
  $('#modal-title').textContent = name;
  $('#modal').classList.add('visible');
  editors.loader.setValue(`loadstring(game:HttpGet("${url}"))()`);
  editors.raw.setValue('-- Fetching...');
  try {
    const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
    const txt = await res.text();
    editors.raw.setValue(txt);
    editors.input.setValue(txt);
  } catch { editors.raw.setValue('-- Failed to load'); }
}
function closeModal() { $('#modal').classList.remove('visible'); }
</script>
</body>
</html>
