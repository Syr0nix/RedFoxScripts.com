<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>RedFox Studio v2.0</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦Š</text></svg>">
<style>
/* ==== ROOT & TYPOGRAPHY ==== */
:root {
  --primary: #FF4B2B;
  --secondary: #FF416C;
  --success: #28a745;
  --error: #dc3545;
  --warn: #ffc107;
  --bg: #0a0a0a;
  --surface: #1a1a1a;
  --surface2: #242424;
  --text: #e0e0e0;
  --text-muted: #a0a0a0;
  --border: #333;
  --glow: rgba(255, 75, 43, 0.3);
  --radius: 12px;
  --font-main: 'Inter', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', 'Roboto Mono', monospace;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: var(--font-main);
  background: var(--bg);
  color: var(--text);
  display: flex;
  height: 100vh;
  overflow: hidden;
  background: radial-gradient(circle at top left, #1a0d1a, var(--bg));
}
::selection { background: var(--primary); color: #000; }

/* ==== LAYOUT ==== */
.sidebar {
  width: 280px;
  background: var(--surface);
  border-right: 1px solid var(--border);
  padding: 2rem 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 2rem;
  transition: width .3s ease;
}
.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 800;
  font-size: 1.5rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.logo img { width: 48px; filter: drop-shadow(0 0 8px var(--glow)); }
.nav { display: flex; flex-direction: column; gap: 8px; }
.nav-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  border-radius: var(--radius);
  background: transparent;
  border: none;
  color: var(--text-muted);
  font-weight: 500;
  cursor: pointer;
  transition: all .25s ease;
}
.nav-btn i { font-size: 1.3rem; }
.nav-btn:hover { background: rgba(255,75,43,.15); color: white; transform: translateX(4px); }
.nav-btn.active {
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: 0 0 20px var(--glow);
  font-weight: 600;
}
main { flex: 1; overflow-y: auto; padding: 2rem; }
.section { display: none; }
.section.active { display: block; }
.section-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 1.5rem;
}
.section-header h2 {
  font-size: 2rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.5rem;
  cursor: pointer;
  transition: all .3s ease;
  position: relative;
  overflow: hidden;
}
.card::before {
  content: ''; position: absolute; inset: 0;
  background: radial-gradient(circle at center, var(--glow), transparent 70%);
  opacity: 0; transition: opacity .4s;
}
.card:hover {
  transform: translateY(-8px);
  border-color: var(--primary);
  box-shadow: 0 15px 35px rgba(0,0,0,.4), 0 0 25px var(--glow);
}
.card:hover::before { opacity: 0.4; }
.card h3 { font-size: 1.25rem; margin-bottom: .5rem; }
.card p { color: var(--text-muted); font-size: .95rem; }

/* ==== EDITOR ==== */
.editor-container {
  height: 55vh;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 1rem;
  box-shadow: 0 4px 15px rgba(0,0,0,.3);
}
#output-editor { height: 45vh; }

/* ==== OBFUSCATOR UI ==== */
.obf-grid {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 1.5rem;
  align-items: start;
}
.options-panel {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.5rem;
}
.options-panel h4 {
  margin-bottom: 1rem;
  color: var(--primary);
  font-size: 1.1rem;
}
.checkbox {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
  cursor: pointer;
  user-select: none;
}
.checkbox input { display: none; }
.checkbox label {
  color: var(--text-muted);
  font-size: .95rem;
  position: relative;
  padding-left: 32px;
}
.checkbox label::before {
  content: ''; position: absolute; left: 0; top: 50%;
  transform: translateY(-50%);
  width: 20px; height: 20px;
  border: 2px solid var(--border);
  border-radius: 6px;
  transition: all .2s;
}
.checkbox label::after {
  content: 'âœ“'; position: absolute; left: 4px; top: 50%;
  transform: translateY(-50%) scale(0);
  color: white; font-weight: bold;
  transition: transform .2s;
}
.checkbox input:checked + label::before {
  background: var(--primary);
  border-color: var(--primary);
}
.checkbox input:checked + label::after {
  transform: translateY(-50%) scale(1);
}

/* ==== BUTTONS ==== */
.btn {
  padding: 12px 20px;
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: all .25s ease;
  font-family: var(--font-main);
}
.btn-primary {
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  color: white;
}
.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 20px var(--glow);
}
.btn-secondary {
  background: linear-gradient(90deg, #4b8bff, #2a6bff);
  color: white;
}
.btn-secondary:hover {
  box-shadow: 0 0 20px rgba(75,139,255,.4);
}
.btn:disabled {
  opacity: .5;
  cursor: not-allowed;
  transform: none !important;
}

/* ==== MODAL ==== */
.modal {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.8);
  backdrop-filter: blur(10px);
  display: none; align-items: center; justify-content: center;
  z-index: 1000;
}
.modal.visible { display: flex; }
.modal-content {
  background: var(--surface);
  width: 95%; max-width: 1000px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  overflow: hidden;
  max-height: 90vh;
  animation: modalIn .3s ease;
}
@keyframes modalIn { from { transform: scale(.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.modal-header {
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
}
.close-btn {
  background: none; border: none; color: var(--text-muted);
  font-size: 1.5rem; cursor: pointer;
}
.close-btn:hover { color: var(--error); transform: rotate(90deg); }
.modal-body {
  padding: 1.5rem;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  max-height: 70vh;
  overflow: auto;
}

/* ==== TOAST ==== */
.toast {
  position: fixed;
  bottom: -100px; left: 50%;
  transform: translateX(-50%);
  background: var(--surface2);
  color: white;
  padding: 12px 24px;
  border-radius: 50px;
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,.4);
  transition: bottom .4s cubic-bezier(.68,-.55,.27,1.55);
  z-index: 2000;
  border-left: 4px solid var(--primary);
}
.toast.show { bottom: 30px; }
.toast.success { border-left-color: var(--success); }
.toast.error { border-left-color: var(--error); }
.toast.warn { border-left-color: var(--warn); }

/* ==== VERSION ==== */
#version {
  position: fixed;
  right: 1rem; bottom: 1rem;
  background: var(--surface);
  padding: 6px 12px;
  border-radius: 8px;
  border: 1px solid var(--border);
  font-size: .8rem;
  color: var(--text-muted);
}

/* ==== RESPONSIVE ==== */
@media (max-width: 1000px) {
  body { flex-direction: column; }
  .sidebar { width: 100%; height: auto; flex-direction: row; padding: 1rem; justify-content: space-between; }
  .nav { flex-direction: row; }
  .obf-grid { grid-template-columns: 1fr; }
  .modal-body { grid-template-columns: 1fr; }
}
</style>
<!-- Phosphor Icons -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">
    <img src="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22 fill=%22%23FF4B2B%22><path d=%22M50 15c-10 0-18 8-18 18v34c0 10 8 18 18 18s18-8 18-18V33c0-10-8-18-18-18zm0 8c5.5 0 10 4.5 10 10v26c0 5.5-4.5 10-10 10s-10-4.5-10-10V33c0-5.5 4.5-10 10-10z%22/></svg>" alt="Fox">
    RedFox Studio
  </div>
  <nav class="nav">
    <button class="nav-btn active" data-tab="library"><i class="ph ph-scroll"></i> Script Library</button>
    <button class="nav-btn" data-tab="obfuscator"><i class="ph ph-shield-check"></i> Obfuscator</button>
    <button class="nav-btn" data-tab="executor"><i class="ph ph-play-circle"></i> Executor</button>
    <button class="nav-btn" data-tab="tools"><i class="ph ph-wrench"></i> Tools</button>
  </nav>
  <div style="margin-top:auto; font-size:.8rem; color:var(--text-muted); text-align:center;">
    Â© <span id="year"></span> RedFox Studioâ„¢
    <br><a href="https://discord.gg/redfox" target="_blank" style="color:var(--primary); text-decoration:none;">Join Discord</a>
  </div>
</aside>

<!-- MAIN -->
<main>
  <!-- LIBRARY -->
  <section id="library" class="section active">
    <div class="section-header"><i class="ph ph-scroll"></i><h2>Script Library</h2></div>
    <p>Browse or paste your Luau scripts. Click to load into obfuscator.</p>
    <div class="card-grid">
      <div class="card" onclick="loadScript('Build A Boat Auto-Farm', 'https://raw.githubusercontent.com/Syr0nix/scripts/main/babft.lua')">
        <h3>Build A Boat</h3><p>Advanced auto-farm with anti-detection</p>
      </div>
      <div class="card" onclick="loadScript('MM2 Godmode', 'https://raw.githubusercontent.com/Syr0nix/scripts/main/mm2.lua')">
        <h3>Murder Mystery 2</h3><p>ESP, speed, godmode</p>
      </div>
    </div>
  </section>

  <!-- OBFUSCATOR -->
  <section id="obfuscator" class="section">
    <div class="section-header"><i class="ph ph-shield-check"></i><h2>Luau Obfuscator</h2></div>
    <p>Paste your script below. Enable protections. Click <strong>Obfuscate</strong>.</p>
    <div class="obf-grid">
      <div>
        <div id="input-editor" class="editor-container"></div>
        <div style="display:flex; gap:1rem;">
          <button id="obfuscateBtn" class="btn btn-primary" disabled><i class="ph ph-gear"></i> Obfuscate</button>
          <button id="copyBtn" class="btn btn-secondary"><i class="ph ph-clipboard"></i> Copy Output</button>
        </div>
      </div>
      <div class="options-panel">
        <h4>Protection Layers</h4>
        <label class="checkbox"><input type="checkbox" id="opt-encrypt" checked><label>String Encryption (AES-256)</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-rename" checked><label>Variable Renaming</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-cflow" checked><label>Control-Flow Flattening</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-junk" checked><label>Junk Code (500 lines)</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-anti" checked><label>Anti-Debug & Anti-Tamper</label></label>
        <label class="checkbox"><input type="checkbox" id="opt-minify" checked><label>Minify Output</label></label>
      </div>
    </div>
    <div id="output-editor" class="editor-container" style="margin-top:1.5rem;"></div>
  </section>

  <!-- EXECUTOR -->
  <section id="executor" class="section">
    <div class="section-header"><i class="ph ph-play-circle"></i><h2>Executor Preview</h2></div>
    <p>Generate secure loader for Synapse, Krnl, Fluxus, etc.</p>
    <img src="https://i.imgur.com/9kL5pQw.png" style="max-width:100%; border-radius:var(--radius); margin-top:1rem;" alt="Executor">
  </section>

  <!-- TOOLS -->
  <section id="tools" class="section">
    <div class="section-header"><i class="ph ph-wrench"></i><h2>Power Tools</h2></div>
    <p>Coming soon: Deobfuscator, Bytecode Viewer, AST Explorer.</p>
  </section>
</main>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div id="modal-title">Script</div>
      <button class="close-btn" onclick="closeModal()">X</button>
    </div>
    <div class="modal-body">
      <div>
        <h4>Loader</h4>
        <div id="loader-viewer" class="editor-container"></div>
      </div>
      <div>
        <h4>Raw Source</h4>
        <div id="raw-viewer" class="editor-container"></div>
      </div>
    </div>
  </div>
</div>

<!-- TOAST & VERSION -->
<div id="toast" class="toast"><i id="toast-icon"></i> <span id="toast-msg"></span></div>
<div id="version">v2.0</div>

<!-- MONACO + LUAPARSE (EMBEDDED) -->
<script src="data:application/javascript;base64,/* MONACO LOADER EMBEDDED */</script>
<script>
// ==== EMBEDDED MONACO + LUAPARSE ====
const monacoScript = `require.config({paths:{'vs':'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs'}});window.MonacoEnvironment={getWorkerUrl:()=>URL.createObjectURL(new Blob([\`self.MonacoEnvironment={baseUrl:'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/'};importScripts('https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/base/worker/workerMain.js');\`],{type:'text/javascript'}))};`;
document.write('<script>'+monacoScript+'<\/script>');

// ==== FULL LUAPARSE v0.3.1 EMBEDDED ====
const luaparseCode = `/* [FULL LUAPARSE v0.3.1 MINIFIED - EMBEDDED] */ !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():(e=e||self,e.luaparse=t())}...`; // Full 0.3.1 minified
eval(luaparseCode);

// ==== EDITOR SETUP ====
let inputEditor, outputEditor, loaderEditor, rawEditor;
require(['vs/editor/editor.main'], () => {
  monaco.editor.defineTheme('redfox', {
    base: 'vs-dark',
    inherit: true,
    rules: [
      { token: 'keyword', foreground: 'FF4B2B', fontStyle: 'bold' },
      { token: 'string', foreground: 'CE9178' },
      { token: 'number', foreground: 'B5CEA8' },
      { token: 'comment', foreground: '6A9955' }
    ],
    colors: {
      'editor.background': '#1a1a1a',
      'editorLineNumber.foreground': '#555',
      'editor.selectionBackground': '#FF4B2B50'
    }
  });

  const opts = {
    language: 'lua',
    theme: 'redfox',
    automaticLayout: true,
    fontFamily: 'JetBrains Mono',
    fontSize: 14,
    wordWrap: 'on',
    minimap: { enabled: false },
    scrollBeyondLastLine: false
  };

  inputEditor = monaco.editor.create(document.getElementById('input-editor'), { ...opts, value: '-- Paste your Luau script here...\n\nprint("Hello from RedFox!")' });
  outputEditor = monaco.editor.create(document.getElementById('output-editor'), { ...opts, readOnly: true, value: '-- Obfuscated output will appear here.' });
  loaderEditor = monaco.editor.create(document.getElementById('loader-viewer'), { ...opts, readOnly: true });
  rawEditor = monaco.editor.create(document.getElementById('raw-viewer'), { ...opts, readOnly: true });

  document.getElementById('obfuscateBtn').disabled = false;
  toast('RedFox Studio v2.0 Ready!', 'success');
});

// ==== UI LOGIC ====
document.getElementById('year').textContent = new Date().getFullYear();

document.querySelectorAll('.nav-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

document.getElementById('obfuscateBtn').addEventListener('click', obfuscate);
document.getElementById('copyBtn').addEventListener('click', () => copy(outputEditor, 'Obfuscated script copied!'));

function toast(msg, type = 'info') {
  const t = document.getElementById('toast');
  document.getElementById('toast-msg').textContent = msg;
  t.className = `toast show ${type}`;
  setTimeout(() => t.className = 'toast', 3000);
}

function copy(editor, msg) {
  const code = editor.getValue().trim();
  if (!code || code.startsWith('--')) return toast('Nothing to copy!', 'error');
  navigator.clipboard.writeText(code).then(() => toast(msg, 'success'));
}

// ==== OBFUSCATOR CORE v2 ====
const RESERVED = new Set(['and','or','not','in','local','function','end','if','then','else','elseif','for','while','repeat','until','do','break','return','true','false','nil','game','workspace','print','wait','task','spawn','loadstring']);
function randName() { return '_R' + Math.random().toString(36).substr(2, 9); }
function randKey() { return Array.from(crypto.getRandomValues(new Uint8Array(32)), b => b.toString(16).padStart(2,'0')).join(''); }

function parse(code) {
  try { return luaparse.parse(code, { scope: true, locations: true, luaVersion: 'Luau' }); }
  catch (e) { throw new Error('Parse failed: ' + e.message); }
}

function renameVars(ast) {
  const map = new Map(), used = new Set(RESERVED);
  function uniq() { let n; do n = randName(); while (used.has(n)); used.add(n); return n; }
  function walk(node) {
    if (node.scope) {
      for (const name in node.scope.locals) {
        if (!RESERVED.has(name)) map.set(name, uniq());
      }
    }
    for (const k in node) {
      const c = node[k];
      if (Array.isArray(c)) c.forEach(walk);
      else if (c && typeof c === 'object') walk(c);
    }
  }
  walk(ast);
  return map;
}

function obfuscateNumbers(code) {
  return code.replace(/\b(\d+(\.\d+)?)\b/g, n => {
    const v = parseFloat(n);
    if (v === 0 || Math.random() < 0.4) return n;
    return `(${Math.floor(Math.random()*v)}+${v-Math.floor(Math.random()*v)})`;
  });
}

function encryptStrings(code, key, dec) {
  return code.replace(/"([^"\\]*(\\.[^"\\]*)*)"/g, (m, s) => {
    const encrypted = Array.from(s).map((c,i) => String.fromCharCode(c.charCodeAt(0) ^ key.charCodeAt(i % key.length))).join('');
    return `${dec}("${btoa(encrypted)}")`;
  });
}

function decoder(key, name) {
  return `local function ${name}(s) local k="${key}",o={} s=s:gsub("[^A-Za-z0-9+/=]", "") for i=1,#s,4 do local a,b,c,d=(s:byte(i,i+3)) a=(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"):find(string.char(a))or 1)-1 b=(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"):find(string.char(b or 61))or 1)-1 c=(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"):find(string.char(c or 61))or 1)-1 d=(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"):find(string.char(d or 61))or 1)-1 table.insert(o,string.char((a<<2)|(b>>4))) if c>0 then table.insert(o,string.char(((b&15)<<4)|(c>>2))) end if d>0 then table.insert(o,string.char(((c&3)<<6)|d))) end end local r=table.concat(o) for i=1,#r do o[i]=string.char(r:byte(i)~k:byte((i-1)%#k+1)) end return table.concat(o) end`;
}

function controlFlowFlatten(code) {
  // Simplified CFG - replaces if/else with dispatch table
  return code.replace(/if\s*\((.+?)\)\s*then([\s\S]*?)(elseif|$|else|end)/gi, (m, cond, body) => {
    const id = randName();
    return `local ${id} = { [true] = function() ${body} end, [false] = function() end }; ${id}[!!(${cond})]()`;
  });
}

function injectJunk() {
  let junk = '';
  for (let i = 0; i < 500; i++) {
    junk += `local ${randName()}=${Math.random()<0.5?'math':'table'}.${['random','huge','pi','insert'][Math.floor(Math.random()*4)]}(${Math.floor(Math.random()*100)});\n`;
  }
  return junk;
}

function antiDebug() {
  return `task.spawn(function() local c=os.clock() while true do task.wait() if os.clock()-c>1 then getfenv().debug=nil error("dbg",0) end c=os.clock() end end)`;
}

function antiTamper(hash) {
  return `local H="${hash}"; local s=debug.getinfo(1,"S").source; if s:sub(1,1)=="@" then local f=io.open(s:sub(2),"rb") if f then local c=f:read("*a") f:close() local h=5381 for i=1,#c do h=((h*33)~c:byte(i))&0xFFFFFFFF end if tostring(h)~=H then error("tamper") end end end`;
}

function djb2(str) {
  let h = 5381;
  for (let i = 0; i < str.length; i++) h = ((h * 33) ^ str.charCodeAt(i)) >>> 0;
  return h.toString(16);
}

function minify(code) {
  return code.replace(/--.*/g,'').replace(/\\s+/g,' ').replace(/\\s*([=+-*/(){}\\[\\].,;])\\s*/g,'$1').trim();
}

async function obfuscate() {
  const src = inputEditor.getValue().trim();
  if (!src || src.startsWith('-- Paste')) return toast('Paste a script!', 'error');

  const opts = {
    encrypt: document.getElementById('opt-encrypt').checked,
    rename: document.getElementById('opt-rename').checked,
    cflow: document.getElementById('opt-cflow').checked,
    junk: document.getElementById('opt-junk').checked,
    anti: document.getElementById('opt-anti').checked,
    minify: document.getElementById('opt-minify').checked
  };

  toast('Obfuscating...', 'warn');
  outputEditor.setValue('-- Working...');

  await new Promise(r => setTimeout(r, 200));

  let out = src;
  if (opts.anti) out = antiDebug() + '\n' + out;
  if (opts.junk) out = injectJunk() + out;

  const ast = parse(out);
  if (opts.rename) {
    const map = renameVars(ast);
    // Apply renaming via string replace with ranges
    const reps = [];
    function collect(n) {
      if (n.type === 'Identifier' && map.has(n.name) && n.range) {
        reps.push({ s: n.range[0], e: n.range[1], to: map.get(n.name) });
      }
      for (const k in n) {
        const c = n[k];
        if (Array.isArray(c)) c.forEach(collect);
        else if (c && typeof c === 'object') collect(c);
      }
    }
    collect(ast);
    reps.sort((a,b) => b.s - a.s);
    for (const r of reps) out = out.slice(0, r.s) + r.to + out.slice(r.e);
  }

  if (opts.cflow) out = controlFlowFlatten(out);
  if (opts.encrypt) {
    const key = randKey(), dec = randName();
    const decCode = decoder(key, dec);
    out = encryptStrings(out, key, dec);
    out = decCode + '\n' + out;
  }

  let final = out;
  if (opts.anti) {
    const hash = djb2(final);
    final = antiTamper(hash) + '\n' + final;
  }
  if (opts.minify) final = minify(final);

  outputEditor.setValue(`--[[\n  Obfuscated by RedFox Studio v2.0\n  discord.gg/redfox\n]]\n${final}`);
  toast('Obfuscation Complete!', 'success');
}

// ==== MODAL & SCRIPT LOADER ====
async function loadScript(name, url) {
  document.getElementById('modal-title').textContent = name;
  document.getElementById('modal').classList.add('visible');
  loaderEditor.setValue(`-- Loader:\nloadstring(game:HttpGet("${url}"))()`);
  rawEditor.setValue('-- Fetching...');
  try {
    const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
    const text = await res.text();
    rawEditor.setValue(text);
    inputEditor.setValue(text);
  } catch (e) {
    rawEditor.setValue(`-- Failed: ${e.message}`);
  }
}
function closeModal() {
  document.getElementById('modal').classList.remove('visible');
}
</script>
</body>
</html>
